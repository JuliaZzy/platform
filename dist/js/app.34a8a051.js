(function(){"use strict";var t={1166:function(t,e,a){t.exports=a.p+"img/实验室.326aeb2c.png"},3054:function(t,e,a){var s=a(5471),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},n=[],r={name:"App"},o=r,l=a(1656),c=(0,l.A)(o,i,n,!1,null,null,null),d=c.exports,h=a(173),p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-container"},[e("LoadingSpinner",{attrs:{visible:t.isLoading}}),t._m(0),t.isLoginModalVisible?e("div",{staticClass:"login-modal"},[e("div",{staticClass:"modal-content"},[e("LoginForm",{on:{"login-success":t.handleLoginSuccess}}),e("button",{staticClass:"login-close-button",on:{click:t.closeLoginModal}},[t._v("关闭")])],1)]):t._e(),t.isFeedbackModalVisible?e("div",{staticClass:"feedback-modal"},[e("div",{staticClass:"feedback-modal-content"},[e("h2",[t._v("反馈意见 / 信息申报")]),e("form",{staticClass:"feedback-form",on:{submit:function(e){return e.preventDefault(),t.submitFeedback.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"name"}},[t._v("您的姓名：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.feedbackForm.name,expression:"feedbackForm.name"}],attrs:{type:"text",id:"name",required:""},domProps:{value:t.feedbackForm.name},on:{input:function(e){e.target.composing||t.$set(t.feedbackForm,"name",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"contact"}},[t._v("您的联系方式：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.feedbackForm.contact,expression:"feedbackForm.contact"}],attrs:{type:"text",id:"contact",required:""},domProps:{value:t.feedbackForm.contact},on:{input:function(e){e.target.composing||t.$set(t.feedbackForm,"contact",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"organization"}},[t._v("您的单位：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.feedbackForm.organization,expression:"feedbackForm.organization"}],attrs:{type:"text",id:"organization"},domProps:{value:t.feedbackForm.organization},on:{input:function(e){e.target.composing||t.$set(t.feedbackForm,"organization",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"details"}},[t._v("反馈/申报事项：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.feedbackForm.details,expression:"feedbackForm.details"}],attrs:{id:"details",rows:"6",required:""},domProps:{value:t.feedbackForm.details},on:{input:function(e){e.target.composing||t.$set(t.feedbackForm,"details",e.target.value)}}})]),e("div",{staticClass:"form-buttons"},[e("button",{staticClass:"submit-button",attrs:{type:"submit"}},[t._v("提交")]),e("button",{staticClass:"close-button",attrs:{type:"button"},on:{click:t.closeFeedbackModal}},[t._v("关闭")])])])])]):t._e(),e("div",{staticClass:"status-row"},[e("div",{staticClass:"status-box clickable",on:{click:function(e){return t.handleStatusBoxClick("上市公司入表")}}},[e("h3",[t._v("2024年度")]),e("p",{staticClass:"status-title"},[t._v("上市公司入表")]),e("p",{staticClass:"status-number"},[t._v(" "+t._s(t.listedCompanyCount)+" 家 ")]),e("div",{staticClass:"status-note"},[t._v("点击查看详情")])]),e("div",{staticClass:"status-box clickable",on:{click:function(e){return t.handleStatusBoxClick("非上市公司入表")}}},[e("h3",[t._v(t._s(t.nonListedMonthDisplay))]),e("p",{staticClass:"status-title"},[t._v("非上市公司入表")]),e("p",{staticClass:"status-number"},[t._v(" "+t._s(t.nonListedCompanyCount)+" 家 ")]),e("div",{staticClass:"status-note"},[t._v("点击查看详情")])]),e("div",{staticClass:"status-box clickable",on:{click:function(e){return t.handleStatusBoxClick("数据相关融资")}}},[e("h3",[t._v("截至2025年03月")]),e("p",{staticClass:"status-title"},[t._v("数据相关融资")]),e("p",{staticClass:"status-number"},[t._v(" "+t._s(t.financeCompanyCount)+" 项 ")]),e("div",{staticClass:"status-note"},[t._v("点击查看详情")])])]),t._m(1),e("div",{staticClass:"grid-container"},[e("div",{staticClass:"grid-item"},[e("div",{staticClass:"table-wrapper"},[e("ChartSpinner",{attrs:{visible:t.isFirstTableLoading}}),e("table",[t._m(2),t._l(t.pagedListedCompanies,(function(a,s){return e("tr",{key:s},[e("td",{domProps:{textContent:t._s(a.company_name)}})])})),t.firstTablePages>1?e("tr",[e("td",{attrs:{colspan:"2"}},[e("div",{staticClass:"pagination"},[e("button",{attrs:{disabled:1===t.firstTablePage},on:{click:function(e){return t.changePage("firstTable",t.firstTablePage-1)}}},[t._v("上一页")]),e("span",[t._v(t._s(t.firstTablePage)+" / "+t._s(t.firstTablePages))]),e("button",{attrs:{disabled:t.firstTablePage===t.firstTablePages},on:{click:function(e){return t.changePage("firstTable",t.firstTablePage+1)}}},[t._v("下一页")])])])]):t._e()],2)],1)]),e("div",{staticClass:"grid-item"},[e("div",{staticClass:"table-wrapper"},[e("ChartSpinner",{attrs:{visible:t.isSecondTableLoading}}),e("table",[t._m(3),t._l(t.pagedNonListedCompanies,(function(a,s){return e("tr",{key:s},[e("td",{domProps:{textContent:t._s(a.company_name)}})])})),t.secondTablePages>1?e("tr",[e("td",{attrs:{colspan:"2"}},[e("div",{staticClass:"pagination"},[e("button",{attrs:{disabled:1===t.secondTablePage},on:{click:function(e){return t.changePage("secondTable",t.secondTablePage-1)}}},[t._v("上一页")]),e("span",[t._v(t._s(t.secondTablePage)+" / "+t._s(t.secondTablePages))]),e("button",{attrs:{disabled:t.secondTablePage===t.secondTablePages},on:{click:function(e){return t.changePage("secondTable",t.secondTablePage+1)}}},[t._v("下一页")])])])]):t._e()],2)],1)]),e("div",{staticClass:"grid-item"},[e("div",{staticClass:"table-wrapper"},[e("ChartSpinner",{attrs:{visible:t.isThirdTableLoading}}),e("table",[t._m(4),t._l(t.pagedFinancingCompanies,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(a.name))])])})),t.thirdTablePages>1?e("tr",[e("td",{attrs:{colspan:"2"}},[e("div",{staticClass:"pagination"},[e("button",{attrs:{disabled:1===t.thirdTablePage},on:{click:function(e){return t.changePage("thirdTable",t.thirdTablePage-1)}}},[t._v("上一页")]),e("span",[t._v(t._s(t.thirdTablePage)+" / "+t._s(t.thirdTablePages))]),e("button",{attrs:{disabled:t.thirdTablePage===t.thirdTablePages},on:{click:function(e){return t.changePage("thirdTable",t.thirdTablePage+1)}}},[t._v("下一页")])])])]):t._e()],2)],1)])]),e("div",{staticClass:"footer"},[e("div",{staticClass:"footer-overlay"}),e("img",{staticClass:"footer-bg",attrs:{src:a(8547),alt:"Footer Image"}}),e("div",{staticClass:"admin"},[e("button",{staticClass:"admin-login-button",on:{click:t.openLoginModal}},[t._v("管理员登录")])]),e("div",{staticClass:"footer-content"},[e("div",{staticClass:"footer-links"},[e("p",[t._v("联系我们：dfcc@saif.sjtu.edu.cn")]),e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.openFeedbackModal.apply(null,arguments)}}},[t._v("反馈意见/申报")])])])])],1)},u=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header"},[e("div",{staticClass:"header-logos"},[e("img",{attrs:{src:a(3546),alt:"SAIF Logo"}}),e("img",{attrs:{src:a(3854),alt:"CAFR Logo"}}),e("img",{attrs:{src:a(1166),alt:"Lab Logo"}})]),e("img",{staticClass:"header-bg-image",attrs:{src:a(8305),alt:"Header Image"}}),e("div",{staticClass:"header-content"},[e("div",{staticClass:"left"},[e("h1",[t._v("中国企业数据资产"),e("br"),t._v("入表名录")])])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-header-container"},[e("div",{staticClass:"table-header"},[e("i",{staticClass:"fas fa-list"}),t._v(" "),e("span",[t._v("榜单")])])])},function(){var t=this,e=t._self._c;return e("tr",[e("th",{attrs:{colspan:"2"}},[t._v("上市公司入表清单")])])},function(){var t=this,e=t._self._c;return e("tr",[e("th",{attrs:{colspan:"2"}},[t._v("非上市公司入表清单")])])},function(){var t=this,e=t._self._c;return e("tr",[e("th",{attrs:{colspan:"2"}},[t._v("数据相关融资企业清单")])])}],g=a(4335),m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-form"},[e("h2",{staticClass:"title"},[t._v("管理员登录")]),t._v(" "),e("div",{staticClass:"input-group"},[e("label",{attrs:{for:"username"}},[t._v("用户名")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",id:"username",placeholder:"请输入用户名"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),e("div",{staticClass:"input-group"},[e("label",{attrs:{for:"password"}},[t._v("密码")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",id:"password",placeholder:"请输入密码"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),e("button",{on:{click:t.handleLogin}},[t._v("登录")]),t.errorMessage?e("p",{staticStyle:{color:"red"}},[t._v(t._s(t.errorMessage))]):t._e()])},f=[],b={name:"LoginForm",data(){return{username:"",password:"",errorMessage:""}},methods:{handleLogin(){this.username&&this.password?g.A.post("/api/login",{username:this.username,password:this.password},{headers:{"Content-Type":"application/json"}}).then((t=>{t.data.success?(localStorage.setItem("adminLoggedIn","true"),this.$emit("login-success")):this.errorMessage="用户名或密码错误"})).catch((t=>{console.error("登录失败:",t),this.errorMessage="登录失败，请稍后重试"})):this.errorMessage="用户名和密码不能为空"}}},v=b,C=(0,l.A)(v,m,f,!1,null,"05bb0d88",null),y=C.exports,_=function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"spinner-container"},[e("div",{staticClass:"spinner"},t._l(8,(function(a){return e("div",{key:a,staticClass:"spinner-dot",style:t.getStyle(a)})})),0)]):t._e()},w=[],S={name:"LoadingSpinner",props:{visible:{type:Boolean,default:!1}},methods:{getStyle(t){const e=45*(t-1);return{transform:`rotate(${e}deg) translate(0, -12px)`}}}},P=S,k=(0,l.A)(P,_,w,!1,null,"25df46fa",null),T=k.exports,D=function(){var t=this,e=t._self._c;return t.visible||t.showWatermark?e("div",{staticClass:"chart-spinner-wrapper"},[t.visible?e("div",{staticClass:"spinner"}):t._e(),t.showWatermark?t._l(t.watermarkPositions,(function(a,s){return e("div",{key:"watermark-"+s,staticClass:"chart-watermark",style:{top:a.top,left:a.left}},[t._v(" "+t._s(t.watermarkText)+" ")])})):t._e()],2):t._e()},F=[],x={name:"ChartSpinner",props:{visible:{type:Boolean,default:!1},showWatermark:{type:Boolean,default:!0}},data(){return{watermarkText:"高金智库数据资产研究课题组",watermarkPositions:[{top:"20%",left:"15%"},{top:"50%",left:"50%"},{top:"70%",left:"75%"}]}}},L=x,$=(0,l.A)(L,D,F,!1,null,"09a8ec10",null),A=$.exports;function O(t){if(!t&&"number"!==typeof t)return"";if("string"===typeof t&&/^\d{4}年\d{2}月$/.test(t))return t;let e;if(t instanceof Date)e=t;else{let a=t;"string"===typeof t&&/^\d{4}-\d{2}$/.test(t)&&(a=`${t}-01T00:00:00.000Z`),e=new Date(a)}if(e instanceof Date&&!isNaN(e.getTime())){let a,s;return"string"===typeof t&&/^\d{4}-\d{2}$/.test(t)?(a=e.getUTCFullYear(),s=String(e.getUTCMonth()+1).padStart(2,"0")):(a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0")),`${a}年${s}月`}return console.warn("[formatToChineseYearMonth] 无法将输入转换为有效日期:",t),String(t)}function N(t){if(!t)return"";try{const e=new Date(t);if(isNaN(e.getFullYear()))return t;const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${a}-${s}-${i}`}catch(e){return console.error("Error formatting date to YYYY-MM-DD:",t,e),t}}function R(t,e=2){if(null===t||void 0===t||""===String(t).trim())return"-";const a=String(t).replace(/,/g,""),s=parseFloat(a);return isNaN(s)?(console.warn("[formatNumberWithSeparators] 输入值无法转换为有效数字:",t),String(t)):s.toLocaleString(void 0,{minimumFractionDigits:e,maximumFractionDigits:e})}function z(t,e=1){if(null===t||void 0===t||""===String(t).trim())return"-";const a=String(t).replace(/%/g,""),s=parseFloat(a);return isNaN(s)?(console.warn("[formatAsPercentage] 输入值无法转换为有效数字以计算百分比:",t),String(t)):(100*s).toFixed(e)+"%"}function M(t){if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return t;const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0");return`${a}-${s}-${i} ${n}:${r}:${o}`}catch(e){return console.error("Error formatting date to YYYY-MM-DD HH:MM:SS:",t,e),t}}var q={name:"HomePage",components:{LoginForm:y,LoadingSpinner:T,ChartSpinner:A},data(){return{isLoading:!0,isFirstTableLoading:!1,isSecondTableLoading:!1,isThirdTableLoading:!1,latestNonListedMonth:"",labels:["上市公司入表","非上市公司入表","数据相关融资"],listedCompanyCount:0,nonListedCompanyCount:0,financeCompanyCount:0,listedCompanies:[],firstTablePage:1,firstTablePages:1,nonListedCompanies:[],secondTablePage:1,secondTablePages:1,financingCompanies:[],thirdTablePage:1,thirdTablePages:1,isLoginModalVisible:!1,isFeedbackModalVisible:!1,feedbackForm:{name:"",contact:"",organization:"",details:""}}},computed:{pagedListedCompanies(){const t=this.listedCompanies||[],e=10*(this.firstTablePage-1);return t.slice(e,e+10)},pagedNonListedCompanies(){const t=this.nonListedCompanies||[],e=10*(this.secondTablePage-1);return t.slice(e,e+10)},pagedFinancingCompanies(){const t=this.financingCompanies||[],e=10*(this.thirdTablePage-1);return t.slice(e,e+10)},nonListedMonthDisplay(){if(!this.latestNonListedMonth)return"截至....年..月";const t=O(this.latestNonListedMonth);return`截至${t}`}},mounted(){this.loadAllData()},methods:{async loadAllData(){this.isLoading=!0,this.isFirstTableLoading=!0,this.isSecondTableLoading=!0,this.isThirdTableLoading=!0;try{const t=await g.A.get("/api/company/homepage-summary"),e=t.data;this.listedCompanyCount=e.listedCompanyCount,this.listedCompanies=e.listedCompanies||[],this.firstTablePages=Math.ceil(e.listedCompanyCount/10),this.nonListedCompanyCount=e.nonListedCompanyCount,this.nonListedCompanies=e.nonListedCompanies||[],this.secondTablePages=Math.ceil(e.nonListedCompanyCount/10),this.latestNonListedMonth=e.latestNonListedMonth,this.financeCompanyCount=e.financeCompanyCount,this.financingCompanies=e.financingCompanies||[],this.thirdTablePages=Math.ceil(this.financingCompanies.length/10)}catch(t){console.error("加载数据出错：",t)}finally{this.isLoading=!1,this.isFirstTableLoading=!1,this.isSecondTableLoading=!1,this.isThirdTableLoading=!1}},changePage(t,e){e<1||e>this[`${t}Pages`]||(this[`${t}Page`]=e)},openLoginModal(){this.isLoginModalVisible=!0},closeLoginModal(){this.isLoginModalVisible=!1},handleLoginSuccess(){this.closeLoginModal();const t=this.$router.resolve({name:"AdminPage"});window.open(t.href,"_blank")},handleStatusBoxClick(t){let e;"非上市公司入表"===t?(e=this.$router.resolve({name:"NLSDashboardPage"}),window.open(e.href,"_blank")):"上市公司入表"===t?(e=this.$router.resolve({name:"LSDashboardPage"}),window.open(e.href,"_blank")):"数据相关融资"===t&&(e=this.$router.resolve({name:"FinanceDashboardPage"}),window.open(e.href,"_blank"))},openFeedbackModal(){this.isFeedbackModalVisible=!0},closeFeedbackModal(){this.isFeedbackModalVisible=!1,this.feedbackForm={name:"",contact:"",organization:"",details:""}},async submitFeedback(){if(console.log("提交反馈:",this.feedbackForm),this.feedbackForm.name&&this.feedbackForm.contact&&this.feedbackForm.details)try{await g.A.post("/api/feedback",this.feedbackForm),alert("反馈提交成功！感谢您的参与。"),this.closeFeedbackModal()}catch(t){console.error("提交反馈失败:",t);const e=t.response?.data?.error||"反馈提交失败，请稍后再试或联系管理员。";alert(e)}else alert("请填写所有必填项（姓名、联系方式、反馈事项）。")}}},I=q,j=(0,l.A)(I,p,u,!1,null,"1da6323a",null),E=j.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dashboard-page"},[e("LoadingSpinner",{attrs:{visible:t.isLoading}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"dashboard-title-block"},[e("h1",{staticClass:"dashboard-title"},[t._v("非上市公司数据资产入表情况")])]),e("FilterSection",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],attrs:{apiPrefix:"/api/nlasset",options:t.options,filters:t.pendingFilters},on:{"filter-change":t.handleFilterChange}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"dashboard-container"},[e("ChartRow",{attrs:{filters:t.filters,mode:"nls",charts:t.charts}}),e("DataTable",{ref:"dataTable",attrs:{filters:t.filters,tableData:t.currentPageData,totalRows:t.totalRows,apiPrefix:"/api/nlasset"},on:{"page-change":t.handlePageChange}})],1)],1)},U=[],V=function(){var t=this,e=t._self._c;return e("div",{staticClass:"filter-section"},[e("div",{staticClass:"filter-row"},[e("div",{staticClass:"filter-item"},[e("label",[t._v("入表时间：")]),e("el-select",{attrs:{placeholder:"开始时间",clearable:""},on:{clear:()=>{t.startDate=""}},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}},t._l(t.options.month_time,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1),e("span",{staticClass:"to-text"},[t._v("-")]),e("el-select",{attrs:{placeholder:"结束时间",clearable:""},on:{clear:()=>{t.endDate=""}},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}},t._l(t.options.month_time,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),e("div",{staticClass:"filter-item"},[e("label",[t._v("省级行政区：")]),e("el-select",{attrs:{placeholder:"全部",clearable:""},on:{clear:()=>{t.province=""}},model:{value:t.province,callback:function(e){t.province=e},expression:"province"}},t._l(t.options.province_area,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)]),e("div",{staticClass:"filter-row"},[e("div",{staticClass:"filter-item"},[e("label",[t._v("入表企业：")]),e("el-select",{attrs:{filterable:"",remote:"",clearable:"",placeholder:"请输入关键词","remote-method":t.fetchCompanyOptions,loading:t.loading.company},on:{clear:t.onCompanyCleared},model:{value:t.company,callback:function(e){t.company=e},expression:"company"}},t._l(t.companyOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("div",{staticClass:"filter-item"},[e("label",[t._v("数据资产内容：")]),e("el-select",{attrs:{filterable:"",remote:"",clearable:"",placeholder:"请输入关键词","remote-method":t.fetchContentOptions,loading:t.loading.content},on:{clear:t.onContentCleared},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}},t._l(t.contentOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),e("div",{staticClass:"filter-row row-actions"},[e("div",{staticClass:"action-buttons"},[e("button",{staticClass:"confirm-btn",on:{click:t.confirmFilters}},[t._v("确认")]),e("button",{staticClass:"clear-all-btn",on:{click:t.clearFilters}},[t._v("清除筛选")])])])])},H=[],Y=(a(8111),a(1701),{name:"NLFilterSection",props:{apiPrefix:{type:String,required:!0},options:{type:Object,required:!0},filters:{type:Object,required:!0}},data(){return{startDate:"",endDate:"",province:"",company:"",content:"",companyOptions:[],contentOptions:[],loading:{company:!1,content:!1}}},watch:{filters:{immediate:!0,deep:!0,handler(t){this.startDate=t.startDate||"",this.endDate=t.endDate||"",this.province=t.province||"",this.company=t.company||"",this.content=t.content||""}}},methods:{fetchCompanyOptions(t){t&&(this.loading.company=!0,g.A.get(`${this.apiPrefix}/search/company?q=${t}`).then((t=>{this.companyOptions=(t.data||[]).map((t=>({label:t,value:t})))})).finally((()=>{this.loading.company=!1})))},fetchContentOptions(t){t&&(this.loading.content=!0,g.A.get(`${this.apiPrefix}/search/content?q=${t}`).then((t=>{this.contentOptions=(t.data||[]).map((t=>({label:t,value:t})))})).finally((()=>{this.loading.content=!1})))},confirmFilters(){const t={startDate:this.startDate,endDate:this.endDate,province:this.province,company:this.company,content:this.content};console.log("【前端 NLFilterSection】发出 filter-change 事件，数据为:",JSON.stringify(t,null,2)),this.$emit("filter-change",t)},clearFilters(){this.startDate="",this.endDate="",this.province="",this.company="",this.content="",this.confirmFilters()},onCompanyCleared(){this.company="",this.confirmFilters()},onContentCleared(){this.content="",this.confirmFilters()}}}),K=Y,G=(0,l.A)(K,V,H,!1,null,"02c4b587",null),J=G.exports,W=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chart-grid"},[e("div",{staticClass:"chart-row"},[t.charts.province_area?.length?e("div",{staticClass:"chart-full"},[e("BarChart1",{attrs:{"chart-data":t.charts.province_area}})],1):t._e()]),e("div",{staticClass:"chart-row"},[t.charts.company_type?.length?e("div",{staticClass:"pie-1"},[e("PieChart1",{attrs:{"chart-data":t.charts.company_type,filters:t.filters,mode:t.mode}})],1):t._e()]),t.charts[t.barChart2Field]?.length?e("div",{staticClass:"chart-row"},[e("div",{staticClass:"chart-full"},[e("BarChart2",{attrs:{"chart-data":t.charts[t.barChart2Field]}})],1)]):t._e(),e("div",{staticClass:"fixed-pie-row"},[t.charts.dataasset_type?.length?e("div",{staticClass:"pie-30"},[e("PieChart2",{attrs:{"chart-data":t.charts.dataasset_type}})],1):t._e(),t.charts.dataasset_register_addrtype?.length?e("div",{staticClass:"pie-70"},[e("PieChart3",{attrs:{"chart-data":t.charts.dataasset_register_addrtype}})],1):t._e()])])},Q=[],X=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v("企业数量按省级行政区分布")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("v-chart",{staticStyle:{width:"100%",height:"360px"},attrs:{option:t.barChartOption}})],1)},Z=[],tt=a(6589);const et=["#2e3968","#005f73","#0a9396","#94d2bd","#e9d8a6","#ee9b00","#ca6702","#bb3e03","#780000","#c1121f","#fdf0d5","#669bbc"];var at=et,st=a(3087),it=a(6411),nt=a(6756),rt=a(4064),ot=a(3416),lt=a(5620),ct=a(5690);(0,st.Y)([it.a,nt.a,rt.a,ot.a,lt.a,ct.a]);var dt=(0,s.defineComponent)({name:"BarChart1",components:{VChart:tt.Ay,ChartSpinner:A},props:{chartData:{type:Array,default:()=>[]}},data(){return{barChartOption:{},loading:!1}},watch:{chartData:{handler(){this.updateChart()},immediate:!0}},methods:{updateChart(){this.loading=!0,setTimeout((()=>{const t={show:!0,position:"top",formatter:"{c}",fontSize:12,color:"#005f73"};this.barChartOption={color:at,tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:this.chartData.map((t=>t.name)),axisLabel:{rotate:0,formatter:t=>t.length>6?t.slice(0,6)+"…":t}},yAxis:{type:"value",name:"入表企业数量（家）",nameLocation:"middle",nameGap:40,nameTextStyle:{fontSize:12}},series:[{type:"bar",data:this.chartData.map((t=>t.value)),label:t}]},this.loading=!1}),500)}}}),ht=dt,pt=(0,l.A)(ht,X,Z,!1,null,"7f6c21a8",null),ut=pt.exports,gt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v("企业数量按企业性质分布")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("v-chart",{ref:"pieChartRef",staticStyle:{width:"100%",height:"360px"},attrs:{option:t.chartOption,autoresize:""},on:{ready:t.onChartReady}})],1)},mt=[],ft=a(9166),bt=a(381);(0,st.Y)([it.a,ft.a,rt.a,ot.a,ct.a,bt.a]);var vt=(0,s.defineComponent)({name:"PieChart1",components:{VChart:tt.Ay,ChartSpinner:A},props:{chartData:{type:Array,required:!0},filters:{type:Object,required:!0},mode:{type:String,default:"nls"}},setup(t){const e=(0,s.ref)({}),a=(0,s.ref)(!1),i=(0,s.ref)(null);let n=null;console.log("[PieChart1] setup: Component setup initiated.");const r=()=>{if(console.log("[PieChart1] updateConnectingLines: Attempting to update lines."),!n)return void console.warn("[PieChart1] updateConnectingLines: chartInstance is NULL. Cannot update lines.");if(!e.value.series||e.value.series.length<2)return void console.warn("[PieChart1] updateConnectingLines: Series data not ready. Cannot update lines.");const t=n.getWidth(),a=n.getHeight();if(console.log(`[PieChart1] updateConnectingLines: Chart dimensions W: ${t}, H: ${a}`),!t||!a||t<=0||a<=0)console.warn("[PieChart1] updateConnectingLines: Chart dimensions invalid. Cannot update lines.");else try{const s=e.value.series[0],i=parseFloat(s.center[0])/100,r=parseFloat(s.center[1])/100,o=s.radius;let l;l="string"===typeof o&&o.endsWith("%")?parseFloat(o)/100*(Math.min(t,a)/2):parseFloat(o);const c=i*t,d=r*a,h=e.value.series[1],p=parseFloat(h.center[0])/100,u=parseFloat(h.center[1])/100,g=h.radius;let m;m="string"===typeof g&&g.endsWith("%")?parseFloat(g)/100*(Math.min(t,a)/2):parseFloat(g);const f=p*t,b=u*a,v=c,C=d-l,y=f,_=b-m,w=c,S=d+l,P=f,k=b+m;console.log("[PieChart1] updateConnectingLines: Calculated Line1 Coords:",`x1:${v}, y1:${C}, x2:${y}, y2:${_}`),console.log("[PieChart1] updateConnectingLines: Calculated Line2 Coords:",`x1:${w}, y1:${S}, x2:${P}, y2:${k}`),n.setOption({graphic:[{id:"line1",shape:{x1:v,y1:C,x2:y,y2:_}},{id:"line2",shape:{x1:w,y1:S,x2:P,y2:k}}]}),console.log("[PieChart1] updateConnectingLines: chart.setOption CALLED for graphic update.")}catch(s){console.error("[PieChart1] updateConnectingLines: Error during calculation or setOption:",s)}},o=async()=>{if(!n)if(await(0,s.nextTick)(),i.value){const t=i.value.chart;console.log("[PieChart1] initChartInstanceAndListeners: Attempting to get instance via pieChartRef.value.chart. Value:",t),t&&"function"===typeof t.getWidth?(console.log("[PieChart1] initChartInstanceAndListeners: Successfully got chart instance via ref using .chart property!"),n=t,n.on("finished",(()=>{console.log('[PieChart1] Event Listener: ECharts "finished" event. Calling updateConnectingLines.'),r()})),n.on("resize",(()=>{console.log('[PieChart1] Event Listener: ECharts "resize" event. Calling updateConnectingLines.'),r()})),n.getWidth()>0&&n.getHeight()>0?(console.log("[PieChart1] initChartInstanceAndListeners: Initial call to updateConnectingLines after getting instance."),r()):console.warn('[PieChart1] initChartInstanceAndListeners: Chart dimensions are zero on first instance retrieval. Relying on "finished" event.')):console.error("[PieChart1] initChartInstanceAndListeners: Failed to get a valid ECharts instance. pieChartRef.value.chart is:",i.value.chart)}else console.error("[PieChart1] initChartInstanceAndListeners: pieChartRef.value is null or undefined.")},l=async()=>{console.log("[PieChart1] buildChart: Function called."),a.value=!0;const i=t.chartData||[],n="地方国企",r="ls"===t.mode?"/api/lasset/summary":"/api/nlasset/summary";try{const a=await g.A.post(r,{filters:{...t.filters,company_type:n},page:1,pageSize:1}),l=a.data.charts?.admin_level||[];e.value={color:at,tooltip:{trigger:"item"},legend:{show:!1},series:[{name:"企业类型",type:"pie",radius:"50%",center:["35%","35%"],label:{show:!0,formatter:({name:t,value:e})=>`${t}: ${e}`,position:"outside"},startAngle:145,labelLine:{show:!0},data:i,z:101},{name:"行政级别",type:"pie",radius:"40%",center:["65%","35%"],label:{show:!0,formatter:({name:t,value:e})=>`${t}: ${e}`,position:"inside"},labelLine:{show:!0},data:l,z:101}],graphic:[{id:"line1",type:"line",shape:{x1:0,y1:0,x2:0,y2:0},style:{stroke:"#888",lineWidth:1},z:100},{id:"line2",type:"line",shape:{x1:0,y1:0,x2:0,y2:0},style:{stroke:"#888",lineWidth:1},z:100}]},console.log("[PieChart1] buildChart: chartOption updated."),await(0,s.nextTick)(),console.log("[PieChart1] buildChart: nextTick finished."),await o()}catch(l){console.error("❌ [PieChart1] buildChart: 加载 PieChart1 数据失败:",l)}finally{a.value=!1}},c=t=>{console.log("[PieChart1] onChartReady (event handler): Called. Instance:",t?"Exists":"Null"),t&&!n&&(console.log("[PieChart1] onChartReady: Setting chartInstance via @ready event (likely primary method failed)."),n=t,t.on("finished",r),t.on("resize",r),n.getWidth()>0&&n.getHeight()>0&&r())};return(0,s.onMounted)((async()=>{console.log("[PieChart1] onMounted: Hook called."),await l(),n||(console.log("[PieChart1] onMounted: chartInstance still null after buildChart. Attempting initChartInstanceAndListeners again (could be redundant if buildChart already succeeded)."),await o())})),(0,s.watch)((()=>[t.chartData,t.filters]),(async()=>{console.log("[PieChart1] watch: Props changed, calling buildChart."),await l()}),{deep:!0}),{chartOption:e,loading:a,pieChartRef:i,onChartReady:c}}}),Ct=vt,yt=(0,l.A)(Ct,gt,mt,!1,null,"67618f15",null),_t=yt.exports,wt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v("企业数量按企业业务类型分布")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("v-chart",{staticStyle:{width:"100%",height:"450px"},attrs:{option:t.chartOption}})],1)},St=[],Pt=(0,s.defineComponent)({name:"BarChart2",components:{"v-chart":tt.Ay,ChartSpinner:A},props:{chartData:{type:Array,default:()=>[]}},setup(t){const e=(0,s.ref)({}),a=(0,s.ref)(!1),i=()=>{a.value=!0,setTimeout((()=>{const s={show:!0,position:"top",formatter:"{c}",fontSize:12,color:"#005f73"};e.value={color:at,tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:t.chartData.map((t=>t.name)),axisLabel:{fontSize:11,rotate:0,interval:0,rich:{customStyle:{lineHeight:20}},formatter:t=>{const e=t.match(/.{1,5}/g)?.slice(0,5)||[t];return e.map((t=>`{customStyle|${t}}`)).join("\n")}}},yAxis:{type:"value",name:"入表企业数量（家）",nameLocation:"middle",nameGap:60,nameTextStyle:{fontSize:14}},series:[{type:"bar",data:t.chartData.map((t=>t.value)),label:s}]},a.value=!1}),500)};return(0,s.watch)((()=>t.chartData),i,{immediate:!0,deep:!0}),{chartOption:e,loading:a}}}),kt=Pt,Tt=(0,l.A)(kt,wt,St,!1,null,"441b1f4d",null),Dt=Tt.exports,Ft=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v("企业数量按数据资产类型分布")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("v-chart",{staticStyle:{width:"100%",height:"60%"},attrs:{option:t.chartOption}})],1)},xt=[],Lt=(0,s.defineComponent)({name:"PieChart2",components:{"v-chart":tt.Ay,ChartSpinner:A},props:{chartData:{type:Array,default:()=>[]}},setup(t){const e=(0,s.ref)({}),a=(0,s.ref)(!1),i=()=>{a.value=!0,setTimeout((()=>{e.value={color:at,tooltip:{trigger:"item"},legend:{show:!1},series:[{type:"pie",radius:"50%",data:t.chartData,label:{show:!0,formatter:({name:t,value:e})=>`${t}: ${e}`,position:"outside"},labelLine:{show:!0},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},a.value=!1}),500)};return(0,s.watch)((()=>t.chartData),i,{immediate:!0,deep:!0}),{chartOption:e,loading:a}}}),$t=Lt,At=(0,l.A)($t,Ft,xt,!1,null,"74dfb300",null),Ot=At.exports,Nt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v("企业数量按资产登记机构分布")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("v-chart",{staticStyle:{width:"100%",height:"60%"},attrs:{option:t.chartOption}})],1)},Rt=[],zt=(0,s.defineComponent)({name:"PieChart3",components:{"v-chart":tt.Ay,ChartSpinner:A},props:{chartData:{type:Array,default:()=>[]}},setup(t){const e=(0,s.ref)({}),a=(0,s.ref)(!1),i=()=>{a.value=!0,setTimeout((()=>{e.value={color:at,tooltip:{trigger:"item"},legend:{show:!1},series:[{type:"pie",radius:"50%",data:t.chartData,label:{show:!0,formatter:({name:t,value:e})=>`${t}: ${e}`,position:"outside"},labelLine:{show:!0},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},a.value=!1}),500)};return(0,s.watch)((()=>t.chartData),i,{immediate:!0,deep:!0}),{chartOption:e,loading:a}}}),Mt=zt,qt=(0,l.A)(Mt,Nt,Rt,!1,null,"1d475cd7",null),It=qt.exports,jt={name:"ChartRow",components:{BarChart1:ut,PieChart1:_t,BarChart2:Dt,PieChart2:Ot,PieChart3:It},props:{charts:{type:Object,required:!0},filters:{type:Object,required:!0},mode:{type:String,required:!0,validator:t=>["nls","ls"].includes(t)}},computed:{barChart2Field(){return"ls"===this.mode?"business_type":"company_business_type"}}},Et=jt,Bt=(0,l.A)(Et,W,Q,!1,null,"8c8226c4",null),Ut=Bt.exports,Vt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-section",staticStyle:{position:"relative"}},[e("h3",{staticClass:"section-title"},[t._v("搜索结果数据详情")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("div",{staticClass:"table-wrapper"},[e("table",{staticClass:"data-table"},[t._m(0),e("tbody",t._l(t.tableData,(function(a,s){return e("tr",{key:s},[e("td",{staticStyle:{"text-align":"center"}},[t._v(t._s((t.currentPage-1)*t.pageSize+s+1))]),e("td",[t._v(t._s(t.formatToChineseYearMonth(a.month_time)))]),e("td",[t._v(t._s(a.province_area))]),e("td",[t._v(t._s(a.company_name))]),e("td",[t._v(t._s(a.dataasset_content))]),e("td",[t._v(t._s(a.dataasset_register_addr))])])})),0)])]),t.totalPages>0&&t.tableData.length>0?e("div",{staticClass:"pagination"},[e("div",{staticClass:"pagination-left"},[e("el-dropdown",{on:{command:t.handleExportCommand}},[e("el-button",{staticClass:"export-small-btn",attrs:{type:"primary"}},[t._v(" 下载数据"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"all"}},[t._v("下载全部数据")]),e("el-dropdown-item",{attrs:{command:"current"}},[t._v("下载当前数据")])],1)],1)],1),e("PaginationControls",{attrs:{"current-page":t.currentPage,"total-pages":t.totalPages,"page-size":t.pageSize},on:{"page-changed":t.changePage}}),e("div",{staticClass:"pagination-right"})],1):t._e()],1)},Ht=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("序号")]),e("th",{staticStyle:{"text-align":"center"}},[t._v("入表月份")]),e("th",[t._v("省级行政区")]),e("th",[t._v("入表企业")]),e("th",[t._v("数据资产内容")]),e("th",[t._v("数据资产登记机构")])])])}];function Yt(t,e){if(!(t instanceof Blob))return console.error("saveBlob Error: Input is not a Blob object."),void alert("下载处理错误：无法识别文件数据。");const a=window.URL.createObjectURL(new Blob([t],{type:"application/pdf"})),s=document.createElement("a");s.href=a,s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}async function Kt({apiUrl:t,filters:e={},excludedColumns:a=[],defaultFilename:s="download.pdf",onStart:i,onFinish:n,onError:r}){"function"===typeof i&&i();const o=t=>{console.error("PDF Download Error:",t),"function"===typeof r?r(t):alert(t)};try{const i={filters:e};Array.isArray(a)&&a.length>0&&(i.excludedColumns=a);const n=await g.A.post(t,i,{responseType:"blob"});if(n.data instanceof Blob&&"application/pdf"===n.data.type){let t=s;const e=n.headers["content-disposition"];if(e){const a=e.match(/filename\*=UTF-8''([^"]+)"?/i);if(a&&a[1])t=decodeURIComponent(a[1]);else{const a=e.match(/filename="?([^"]+)"?/i);a&&a[1]&&(t=decodeURIComponent(a[1]))}}Yt(n.data,t)}else if(n.data instanceof Blob){const t=await n.data.text();try{const e=JSON.parse(t);o(`导出失败: ${e.error||"服务器返回了非PDF文件。"}`)}catch(l){o(`导出失败: 服务器返回了非PDF文件 (${n.data.type})。`)}}else o("导出失败：服务器未返回有效的PDF文件。")}catch(c){let t="下载失败，请检查网络或联系管理员。";if(c.response&&c.response.data&&c.response.data instanceof Blob)try{const e=await c.response.data.text(),a=JSON.parse(e);a&&a.error&&(t=`导出失败: ${a.error}`)}catch(l){}else c.response&&c.response.data&&c.response.data.error?t=`导出失败: ${c.response.data.error}`:c.message&&(t=`下载失败: ${c.message}`);o(t)}finally{"function"===typeof n&&n()}}var Gt=function(){var t=this,e=t._self._c;return t.totalPages>1?e("div",{staticClass:"pagination"},[e("div",{staticClass:"pagination-center"},[e("button",{attrs:{disabled:1===t.currentPage},on:{click:function(e){return t.goToPage(t.currentPage-1)}}},[t._v(" 上一页 ")]),e("span",{staticClass:"page-info"},[t._v(" 第 "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.jumpPageInput,expression:"jumpPageInput",modifiers:{number:!0}}],staticClass:"page-jump-input",attrs:{type:"number",min:1,max:t.totalPages,"aria-label":"跳转到指定页码"},domProps:{value:t.jumpPageInput},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleJump.apply(null,arguments)},blur:[t.validateAndCorrectJumpInput,function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||(t.jumpPageInput=t._n(e.target.value))}}}),t._v(" / "+t._s(t.totalPages)+" 页 ")]),e("button",{attrs:{disabled:!t.isValidJumpInput},on:{click:t.handleJump}},[t._v("跳转")]),e("button",{attrs:{disabled:t.currentPage===t.totalPages},on:{click:function(e){return t.goToPage(t.currentPage+1)}}},[t._v(" 下一页 ")])])]):t._e()},Jt=[],Wt={name:"PaginationControls",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0}},data(){return{jumpPageInput:this.currentPage}},watch:{currentPage(t){this.jumpPageInput=t}},computed:{isValidJumpInput(){const t=parseInt(this.jumpPageInput,10);return!isNaN(t)&&t>=1&&t<=this.totalPages}},methods:{goToPage(t){t>=1&&t<=this.totalPages&&t!==this.currentPage&&this.$emit("page-changed",t)},handleJump(){this.validateAndCorrectJumpInput();const t=parseInt(this.jumpPageInput,10);this.isValidJumpInput&&t!==this.currentPage?this.goToPage(t):t===this.currentPage&&(this.jumpPageInput=this.currentPage)},validateAndCorrectJumpInput(){let t=parseInt(this.jumpPageInput,10);isNaN(t)||t<1?this.jumpPageInput=1:t>this.totalPages?this.jumpPageInput=this.totalPages:this.jumpPageInput=t}}},Qt=Wt,Xt=(0,l.A)(Qt,Gt,Jt,!1,null,"b228a4e6",null),Zt=Xt.exports,te={name:"NLDataTable",components:{ChartSpinner:A,PaginationControls:Zt},props:{filters:{type:Object,required:!0},tableData:{type:Array,required:!0},totalRows:{type:Number,required:!0},pageSize:{type:Number,default:10},apiPrefix:{type:String,required:!0}},data(){return{currentPage:1,initialized:!1,loading:!1}},computed:{totalPages(){return Math.max(1,Math.ceil(this.totalRows/this.pageSize))}},watch:{filters:{handler(){this.initialized?(this.loading=!0,this.currentPage=1,this.emitPageChange()):this.initialized=!0},immediate:!0,deep:!0}},methods:{changePage(t){t<1||t>this.totalPages||(this.loading=!0,this.currentPage=t,this.emitPageChange())},emitPageChange(){this.$emit("page-change",this.currentPage)},stopLoading(){this.loading=!1,this.$emit("data-loaded")},handleExportCommand(t){console.log("[DataTable] handleExportCommand called with command:",t),"all"===t?this.downloadPdfAll():"current"===t&&this.downloadPdfCurrent()},async downloadPdfAll(){const t=`非上市公司数据资产入表清单_全部_${Date.now()}.pdf`;await Kt({apiUrl:`${this.apiPrefix}/export`,filters:{},defaultFilename:t,onStart:()=>{this.loading=!0},onFinish:()=>{this.loading=!1},onError:t=>{alert(t)}})},async downloadPdfCurrent(){const t=`非上市公司数据资产入表清单_筛选后_${Date.now()}.pdf`;await Kt({apiUrl:`${this.apiPrefix}/export`,filters:this.filters,defaultFilename:t,onStart:()=>{this.loading=!0},onFinish:()=>{this.loading=!1},onError:t=>{alert(t)}})},formatToChineseYearMonth:O}},ee=te,ae=(0,l.A)(ee,Vt,Ht,!1,null,"26f5a01a",null),se=ae.exports,ie={name:"NLSDashboardPage",components:{FilterSection:J,ChartRow:Ut,DataTable:se,LoadingSpinner:T},data(){return{isLoading:!0,filters:{},pendingFilters:{},pageSize:10,currentPageData:[],totalRows:0,charts:{},options:{}}},methods:{async handleFilterChange(t){console.log("【前端 NLSDashboardPage】handleFilterChange 接收到 newFilters:",JSON.stringify(t,null,2)),this.filters={...t},console.log("【前端 NLSDashboardPage】this.filters 更新为:",JSON.stringify(this.filters,null,2)),await this.fetchSummaryData(1)},async handlePageChange(t){await this.fetchSummaryData(t)},async fetchSummaryData(t){console.log("【前端 NLSDashboardPage】fetchSummaryData 发送的 filters:",JSON.stringify(this.filters,null,2),"请求页码:",t);try{const e=await g.A.post("/api/nlasset/summary",{filters:this.filters,page:t,pageSize:this.pageSize});this.charts=e.data.charts||{},this.currentPageData=e.data.table.rows||[],this.totalRows=e.data.table.total||0,this.options=e.data.options||{},this.pendingFilters={...this.filters}}catch(e){console.error("❌ 加载 summary 数据失败:",e)}finally{this.isLoading=!1,this.$refs.dataTable?.stopLoading?.()}}},mounted(){this.fetchSummaryData(1)}},ne=ie,re=(0,l.A)(ne,B,U,!1,null,"29f85f87",null),oe=re.exports,le=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dashboard-page"},[e("LoadingSpinner",{attrs:{visible:t.isLoading}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"dashboard-title-block"},[e("h1",{staticClass:"dashboard-title"},[t._v("上市公司数据资产入表情况")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"dashboard-container"},[e("LChartRow",{attrs:{filters:t.chartRowActiveFilters}})],1),e("transition",{attrs:{name:"slide-fade"}},[!t.isLoading&&t.initialOptionsLoaded?e("LFilterSection",{ref:"lFilterSectionRef",attrs:{filters:t.currentFilters,options:t.filterDropdownOptions,"api-prefix":"/api/lasset"},on:{"filter-change":t.handleFilterApplyForTable}}):t._e()],1),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading&&t.initialOptionsLoaded,expression:"!isLoading && initialOptionsLoaded"}],staticClass:"data-table-container",staticStyle:{margin:"20px 30px"}},[e("LSDataTable",{ref:"lsDataTableRef",attrs:{filters:t.lsTableActiveFilters,tableData:t.lsTableData,totalRows:t.lsTableTotalRows,pageSize:t.lsTablePageSize,apiPrefix:"/api/lasset"},on:{"page-change":t.handleLSPageChange}})],1)],1)},ce=[],de=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chart-grid"},[e("div",{staticClass:"chart-row"},[t.comboData.barSeries?.length&&t.comboData.lineSeries?.data?.length?e("div",{staticClass:"chart-full"},[e("ComboBarLineChart",{attrs:{chartTitle:"A股数据资源入表企业数量和金额",categories:t.comboData.categories,barSeries:t.comboData.barSeries,"y-axis-bar-name":"入表企业数量（家）",lineSeries:t.comboData.lineSeries,"y-axis-line-name":"入表企业金额（亿）"}})],1):t._e()]),e("div",{staticClass:"chart-row"},[t.groupedSubjectData.countSeries?.length?e("div",{staticClass:"subject-chart-container equal-half"},[e("GroupedBarChart",{attrs:{"chart-data":t.groupedSubjectData.countSeries,chartTitle:"A股数据资源入表公司分科目分布情况","row-key":"入表科目","col-key":"报告时间"}})],1):t._e(),t.actualControllerData?.length?e("div",{staticClass:"subject-chart-container equal-half"},[e("GroupedBarChart",{attrs:{"chart-data":t.actualControllerData,chartTitle:"A股数据资源入表公司分实控人分布情况","row-key":"name","col-key":"报告时间"}})],1):t._e()]),t._l(t.groupedFields,(function(a){return e("div",{key:a.field,staticClass:"chart-row"},[t.groupedCharts[a.field]?.length?e("div",{staticClass:"chart-full"},[e("GroupedBarChart",{attrs:{"chart-data":t.groupedCharts[a.field],chartTitle:a.title,"row-key":"name","col-key":"报告时间"}})],1):t._e()])}))],2)},he=[],pe=(a(4114),a(7588),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v(t._s(t.chartTitle))]),e("ChartSpinner",{attrs:{visible:t.loading}}),!t.loading&&t.chartOption.series&&t.chartOption.series.length?e("v-chart",{staticStyle:{width:"100%",height:"440px"},attrs:{option:t.chartOption}}):t._e()],1)}),ue=[],ge=(0,s.defineComponent)({name:"ComboBarLineChart",components:{VChart:tt.Ay,ChartSpinner:A},props:{chartTitle:{type:String,default:"柱状图 + 折线图"},categories:{type:Array,default:()=>[]},barSeries:{type:Array,default:()=>[]},lineSeries:{type:Object,default:()=>({name:"折线",data:[]})},yAxisBarName:{type:String,default:"数量（个）"},yAxisLineName:{type:String,default:"金额（亿元）"}},setup(t){const e=(0,s.ref)({}),a=(0,s.ref)(!1),i=()=>{a.value=!0,setTimeout((()=>{const s={show:!0,position:"top",formatter:"{c}",fontSize:12,color:"#005f73"},i=(t.barSeries||[]).map(((t,e)=>({name:t.name,type:"bar",data:t.data||[],yAxisIndex:0,itemStyle:{color:at[e%at.length]},label:s}))),n="#ee9b00",r=t.lineSeries?.name||"折线",o={show:!0,position:"top",formatter:function(t){if(null==t.value||isNaN(parseFloat(t.value)))return"";const e=parseFloat(t.value);return e.toFixed(2)},fontSize:12,color:"#ee9b00"},l={name:r,type:"line",data:t.lineSeries?.data||[],yAxisIndex:1,symbol:"circle",lineStyle:{width:3,color:n},itemStyle:{color:n},label:o};e.value={color:at,tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(t){let e="";return t&&t.length>0&&(e+=(t[0].axisValueLabel||t[0].name)+"<br />",t.forEach((t=>{let a=t.value;if(t.seriesName===r){const e=parseFloat(t.value);a=isNaN(e)?null==t.value?"-":String(t.value):e.toFixed(2)}else{const e=parseFloat(t.value);a=isNaN(e)?null==t.value?"—":String(t.value):e.toFixed(0)}e+=t.marker+" "+t.seriesName+": <b>"+a+"</b><br />"}))),e}},legend:{top:10},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:t.categories||[],axisLabel:{fontSize:11,rotate:0,interval:0,formatter:t=>t.length>6?t.slice(0,6)+"…":t}},yAxis:[{type:"value",name:t.yAxisBarName,min:0,max:120,interval:20,nameLocation:"middle",nameGap:45,nameTextStyle:{fontSize:14}},{type:"value",name:t.yAxisLineName,min:0,max:24,interval:4,nameLocation:"middle",nameGap:45,nameTextStyle:{fontSize:14}}],series:[...i,l]},a.value=!1}),500)};return(0,s.watch)((()=>[t.barSeries,t.lineSeries,t.categories]),i,{immediate:!0,deep:!0}),{chartOption:e,loading:a}}}),me=ge,fe=(0,l.A)(me,pe,ue,!1,null,"6c8c2c6a",null),be=fe.exports,ve=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"chart-wrapper",staticStyle:{position:"relative"}},[e("div",{staticClass:"chart-title"},[t._v(t._s(t.chartTitle))]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("v-chart",{ref:"vueChartRef",staticStyle:{width:"100%",height:"440px"},attrs:{option:t.chartOption}})],1)},Ce=[],ye=(0,s.defineComponent)({name:"GroupedBarChart",components:{VChart:tt.Ay,ChartSpinner:A},props:{chartTitle:{type:String,default:"Grouped Bar Chart"},chartData:{type:Array,default:()=>[]},rowKey:{type:String,default:"类别"},valKey:{type:String,default:"value"},yAxisName:{type:String,default:"入表企业数量（家）"}},setup(t){const e=(0,s.ref)({}),a=(0,s.ref)(!1),i=(0,s.ref)(null),n=()=>{a.value=!0,setTimeout((()=>{const n=t.chartData||[];if(0===n.length)return e.value={},void(a.value=!1);const r=n.length;let o=[...at];if(r>0){const t=at.slice(0,r);o=[...t].reverse()}const l={show:!0,position:"top",formatter:function(e){if(null==e.value||isNaN(parseFloat(e.value)))return"";const a=parseFloat(e.value);return t.chartTitle&&t.chartTitle.includes("亿")?a.toFixed(2):a.toFixed(0)},fontSize:10,color:"#005f73"},c=n[0].data.map((e=>e[t.rowKey])),d=n.map(((e,a)=>({name:e.name,type:"bar",data:e.data.map((e=>e[t.valKey])),barGap:0,barCategoryGap:"50%",itemStyle:{color:o[a%o.length]},label:l})));e.value={color:o,tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){let a="";e&&e.length>0&&(a=e[0].axisValueLabel||e[0].name,a+="<br/>");const s=t.chartTitle&&t.chartTitle.includes("金额");return e.forEach((t=>{let e=t.value;if(null==e||isNaN(parseFloat(e)))e=null==e?"—":String(e);else{const t=parseFloat(e);e=s?t.toFixed(2):t.toFixed(0)}a+=t.marker+" "+t.seriesName+": "+e+"<br/>"})),a}},legend:{top:10},grid:{left:"10%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:c,axisLabel:{fontSize:11,rotate:0,interval:0,rich:{customStyle:{lineHeight:20}},formatter:e=>{const a=t.chartTitle;if("A股数据资源入表公司分实控人分布情况"!==a){if("A股数据资源入表公司分行业分布情况"===a){const t=e.match(/.{1,6}/g)||[e];return t.map((t=>`{customStyle|${t}}`)).join("\n")}return e}switch(e){case"个人":return"{customStyle|个人}";case"中央":return"{customStyle|中央}\n{customStyle|（国资委、中央国家机关、中央国有企业）}";case"地方":return"{customStyle|地方}\n{customStyle|（地方国资委、地方政府、地方国有企业）}";case"其他":return"{customStyle|其他}\n{customStyle|（大学、个人境外、境外）}";default:return`{customStyle|${e}}`}}}},yAxis:{type:"value",name:t.yAxisName,nameLocation:"middle",nameGap:50,nameTextStyle:{fontSize:14}},series:d},a.value=!1,(0,s.nextTick)((()=>{i.value&&i.value.chart?i.value.chart.resize():i.value&&"function"===typeof i.value.resize&&i.value.resize()}))}),300)};return(0,s.watch)((()=>t.chartData),n,{immediate:!0,deep:!0}),{chartOption:e,loading:a,vueChartRef:i}}}),_e=ye,we=(0,l.A)(_e,ve,Ce,!1,null,"17f22ba7",null),Se=we.exports,Pe={name:"LChartRow",components:{ComboBarLineChart:be,GroupedBarChart:Se},props:{filters:{type:Object,required:!0}},data(){return{comboData:{barSeries:[],lineSeries:{}},groupedSubjectData:{countSeries:[],sumSeries:[]},actualControllerData:[],groupedFields:[{field:"所属证券行业分布",displayKey:"所属证券行业分布",title:"A股数据资源入表公司分行业分布情况"},{field:"市值规模",displayKey:"市值规模",title:"A股数据资源入表公司分市值规模分布情况"},{field:"省份",displayKey:"省份",title:"A股数据资源入表公司分区域位置分布情况"}],groupedCharts:{},isTablesLoading:!0}},watch:{filters:{handler(){this.loadAllData()},deep:!0,immediate:!0}},methods:{restructureDataForGroupedBarChart(t,e,a,s){if(!t||0===t.length)return[];const i=[],n=new Set;t.forEach((t=>{const e=t[a];n.has(e)||(n.add(e),i.push(e))}));const r=new Map;t.forEach((t=>{const a=t[e];r.has(a)||r.set(a,[]),r.get(a).push(t)}));const o=Array.from(r.keys()).sort(),l=o.map((t=>{const e=r.get(t),n=new Map(e.map((t=>[t[a],parseFloat(t[s])||0])));return{name:t,data:i.map((t=>({[a]:t,[s]:n.get(t)||0})))}}));return l},async loadAllData(){void 0!==this.isTablesLoading&&(this.isTablesLoading=!0);try{const t=[g.A.post("/api/lchart/combo1",{filters:this.filters}),g.A.post("/api/lchart/subject-bars",{filters:this.filters}),g.A.post("/api/lchart/group-field",{filters:this.filters,field:"实控人"})];this.groupedFields.forEach((e=>{t.push(g.A.post("/api/lchart/group-field",{filters:this.filters,field:e.field}))}));const e=await Promise.all(t),a=e[0],s=e[1],i=e[2],n=e.slice(3),r=a.data||{},o=r.barSeries||[],l=r.lineSeriesForChart||[],c=new Set;o.forEach((t=>t["报告时间"]&&c.add(t["报告时间"]))),l.forEach((t=>t["报告时间"]&&c.add(t["报告时间"])));const d=Array.from(c).sort(((t,e)=>(t.startsWith("Q")&&e.startsWith("Q"),t.localeCompare(e))));this.comboData.categories=d;const h=new Map(o.map((t=>[t["报告时间"],parseFloat(t["数据资源入表数量"])||0]))),p=d.map((t=>h.get(t)||0));this.comboData.barSeries=[{name:"数据资源入表数量",data:p}];const u=new Map(l.map((t=>[t["报告时间"],parseFloat(t["数据资源入表总额（单位：亿元）"])||0]))),m=d.map((t=>u.get(t)||0));this.comboData.lineSeries={name:"数据资源入表总额",data:m};const f=s.data||{};let b=f.countSeries||[],v=f.sumSeries||[];const C=this.restructureDataForGroupedBarChart(b,"报告时间","入表科目","value"),y=this.restructureDataForGroupedBarChart(v,"报告时间","入表科目","value");this.groupedSubjectData={countSeries:C,sumSeries:y};const _=i.data??[];this.actualControllerData=this.restructureDataForGroupedBarChart(_,"报告时间","name","value"),this.groupedFields.forEach(((t,e)=>{const a=n[e]?.data??[],s=this.restructureDataForGroupedBarChart(a,"报告时间","name","value");this.$set(this.groupedCharts,t.field,s)}))}catch(t){console.error("❌ 加载图表数据失败 LChartRow:",t),this.comboData={barSeries:[],lineSeries:{}},this.groupedSubjectData={countSeries:[],sumSeries:[]},this.groupedCharts={},this.actualControllerData=[]}finally{void 0!==this.isTablesLoading&&(this.isTablesLoading=!1)}}}},ke=Pe,Te=(0,l.A)(ke,de,he,!1,null,"77ebe131",null),De=Te.exports,Fe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"filter-section"},[e("div",{staticClass:"filter-row"},[e("div",{staticClass:"filter-item"},[e("label",[t._v("报告时间：")]),e("el-select",{attrs:{placeholder:"全部",clearable:""},on:{change:t.handleImmediateFilterChange,clear:()=>{t.internalFilters.quarter="",t.handleImmediateFilterChange()}},model:{value:t.internalFilters.quarter,callback:function(e){t.$set(t.internalFilters,"quarter",e)},expression:"internalFilters.quarter"}},t._l(t.options.quarter,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),e("div",{staticClass:"filter-item"},[e("label",[t._v("省份：")]),e("el-select",{attrs:{placeholder:"全部",clearable:""},on:{change:t.handleImmediateFilterChange,clear:()=>{t.internalFilters.province_area="",t.handleImmediateFilterChange()}},model:{value:t.internalFilters.province_area,callback:function(e){t.$set(t.internalFilters,"province_area",e)},expression:"internalFilters.province_area"}},t._l(t.options.province_area,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)]),e("div",{staticClass:"filter-row"},[e("div",{staticClass:"filter-item"},[e("label",[t._v("公司：")]),e("el-select",{attrs:{filterable:"",remote:"",clearable:"",placeholder:"请输入公司关键词","remote-method":t.fetchCompanyOptions,loading:t.loading.company},on:{change:t.handleElSelectChange,clear:()=>{t.internalFilters.company="",t.handleElSelectChange()}},model:{value:t.internalFilters.company,callback:function(e){t.$set(t.internalFilters,"company",e)},expression:"internalFilters.company"}},t._l(t.companyOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("div",{staticClass:"filter-item"},[e("label",[t._v("所属证券行业分布：")]),e("el-select",{attrs:{filterable:"",remote:"",clearable:"",placeholder:"请输入行业关键词","remote-method":t.fetchContentOptions,loading:t.loading.content},on:{change:t.handleElSelectChange,clear:()=>{t.internalFilters.dataasset_content="",t.handleElSelectChange()}},model:{value:t.internalFilters.dataasset_content,callback:function(e){t.$set(t.internalFilters,"dataasset_content",e)},expression:"internalFilters.dataasset_content"}},t._l(t.contentOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),e("div",{staticClass:"filter-row row-actions"},[e("div",{staticClass:"action-buttons"},[e("button",{staticClass:"confirm-btn",on:{click:t.confirmFilters}},[t._v("确认")]),e("button",{staticClass:"clear-all-btn",on:{click:t.clearAllFilters}},[t._v("清除筛选")]),e("el-dropdown",{attrs:{trigger:"hover"},on:{command:t.handleDownloadCommand}},[e("el-button",{staticClass:"download-btn"},[t._v(" 下载数据"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t._l(t.options.quarter,(function(a){return e("el-dropdown-item",{key:a,attrs:{command:a}},[t._v(" "+t._s(a)+" 数据 ")])})),t.options.quarter&&0!==t.options.quarter.length?t._e():e("el-dropdown-item",{attrs:{disabled:""}},[t._v(" 无可用报告时间 ")])],2)],1)],1)])])},xe=[],Le=(a(3579),{name:"LFilterSection",props:{filters:{type:Object,required:!0},options:{type:Object,required:!0},apiPrefix:{type:String,required:!0}},data(){return{internalFilters:{quarter:"",province_area:"",company:"",dataasset_content:""},companyOptions:[],contentOptions:[],loading:{company:!1,content:!1,download:!1},tempCompany:"",tempDataassetContent:""}},watch:{filters:{immediate:!0,deep:!0,handler(t){this.internalFilters.quarter=t.quarter||"",this.internalFilters.province_area=t.province_area||"",this.internalFilters.company=t.company||"",this.internalFilters.dataasset_content=t.dataasset_content||"",!t.company||this.companyOptions.length&&this.companyOptions.some((e=>e.value===t.company))||this.fetchCompanyOptions(t.company,!0),!t.dataasset_content||this.contentOptions.length&&this.contentOptions.some((e=>e.value===t.dataasset_content))||this.fetchContentOptions(t.dataasset_content,!0)}}},methods:{fetchCompanyOptions(t,e=!1){t||e?!t&&e||(this.loading.company=!0,g.A.get(`${this.apiPrefix}/search/company?q=${t}`).then((a=>{this.companyOptions=(a.data||[]).map((t=>({label:String(t),value:String(t)}))),e&&t&&!this.companyOptions.some((e=>e.value===t))&&this.companyOptions.unshift({label:String(t),value:String(t)})})).catch((t=>{console.error("Error fetching company options:",t),this.companyOptions=[]})).finally((()=>{this.loading.company=!1}))):this.companyOptions=[]},fetchContentOptions(t,e=!1){t||e?!t&&e||(this.loading.content=!0,g.A.get(`${this.apiPrefix}/search/content?q=${t}`).then((a=>{this.contentOptions=(a.data||[]).map((t=>({label:String(t),value:String(t)}))),e&&t&&!this.contentOptions.some((e=>e.value===t))&&this.contentOptions.unshift({label:String(t),value:String(t)})})).catch((t=>{console.error("Error fetching content options:",t),this.contentOptions=[]})).finally((()=>{this.loading.content=!1}))):this.contentOptions=[]},handleImmediateFilterChange(){},handleElSelectChange(){},confirmFilters(){this.$emit("filter-change",{...this.internalFilters})},clearAllFilters(){this.internalFilters.quarter="",this.internalFilters.province_area="",this.internalFilters.company="",this.internalFilters.dataasset_content="",this.companyOptions=[],this.contentOptions=[],this.confirmFilters()},async handleDownloadCommand(t){t&&await Kt({apiUrl:`${this.apiPrefix}/export`,filters:{quarter:t},defaultFilename:`A股上市公司数据资产入表清单_${t}.pdf`,onStart:()=>{this.loading.download=!0},onFinish:()=>{this.loading.download=!1},onError:t=>{alert(t)}})}}}),$e=Le,Ae=(0,l.A)($e,Fe,xe,!1,null,"babd6f54",null),Oe=Ae.exports,Ne=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-section",staticStyle:{position:"relative"}},[e("h3",{staticClass:"section-title"},[t._v("搜索结果数据详情")]),e("ChartSpinner",{attrs:{visible:t.loading}}),e("div",{staticClass:"table-wrapper"},[e("table",{staticClass:"data-table"},[t._m(0),e("tbody",t._l(t.tableData,(function(a,s){return e("tr",{key:s},[e("td",{staticStyle:{"text-align":"center"}},[t._v(t._s((t.currentPage-1)*t.pageSize+s+1))]),e("td",[t._v(t._s(a["公司"]))]),e("td",[t._v(t._s(a["入表科目"]))]),e("td",[t._v(t._s(a["省份"]))]),e("td",[t._v(t._s(a["所属证券行业分布"]))]),e("td",{staticClass:"number-cell"},[t._v(t._s(t.formatNumber(a["数据资源入表总额（万元）"])))]),e("td",{staticClass:"number-cell"},[t._v(t._s(t.formatPercentage(a["数据资产占总资产比例"])))]),e("td",{staticClass:"number-cell"},[t._v(t._s(t.formatNumber(a["无形资产-数据资源入表金额（万元）"])))]),e("td",{staticClass:"number-cell"},[t._v(t._s(t.formatNumber(a["开发支出-数据资源入表金额（万元）"])))]),e("td",{staticClass:"number-cell"},[t._v(t._s(t.formatNumber(a["存货-数据资源入表金额（万元）"])))]),e("td",[t._v(t._s(a["报告时间"]))])])})),0)])]),t.totalPages>0&&t.tableData.length>0?e("PaginationControls",{attrs:{"current-page":t.currentPage,"total-pages":t.totalPages},on:{"page-changed":t.handlePageChangeFromPagination}}):t._e()],1)},Re=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("序号")]),e("th",[t._v("公司")]),e("th",[t._v("入表科目")]),e("th",[t._v("省份")]),e("th",[t._v("所属证券行业分布")]),e("th",[t._v("数据资源入表总额"),e("br"),t._v("（万元）")]),e("th",[t._v("数据资产"),e("br"),t._v("占总资产比例")]),e("th",[t._v("无形资产-"),e("br"),t._v("数据资源入表金额"),e("br"),t._v("（万元）")]),e("th",[t._v("开发支出-"),e("br"),t._v("数据资源入表金额"),e("br"),t._v("（万元）")]),e("th",[t._v("存货-"),e("br"),t._v("数据资源入表金额"),e("br"),t._v("（万元）")]),e("th",[t._v("报告时间")])])])}],ze={name:"LDataTable",components:{ChartSpinner:A,PaginationControls:Zt},props:{filters:{type:Object,required:!0},tableData:{type:Array,required:!0},totalRows:{type:Number,required:!0},pageSize:{type:Number,default:10}},data(){return{currentPage:1,initialized:!1,loading:!1}},computed:{totalPages(){return 0===this.totalRows||0===this.pageSize?0:Math.max(1,Math.ceil(this.totalRows/this.pageSize))}},watch:{filters:{handler(){this.initialized?(this.loading=!0,this.currentPage=1,this.emitPageChange()):this.initialized=!0},deep:!0},totalRows(){this.adjustCurrentPage()},pageSize(){this.adjustCurrentPage()}},methods:{handlePageChangeFromPagination(t){t>=1&&t<=this.totalPages&&t!==this.currentPage&&(this.loading=!0,this.currentPage=t,this.emitPageChange())},emitPageChange(){this.$emit("page-change",this.currentPage)},stopLoading(){this.loading=!1},adjustCurrentPage(){this.totalPages>0&&this.currentPage>this.totalPages?this.currentPage=this.totalPages:(0===this.totalPages&&this.totalRows>0||this.totalPages>0&&this.currentPage<1)&&(this.currentPage=1)},formatToChineseYearMonth:O,formatNumber:R,formatPercentage:z}},Me=ze,qe=(0,l.A)(Me,Ne,Re,!1,null,"e22fbffa",null),Ie=qe.exports,je={name:"LSDashboardPage",components:{LChartRow:De,LSDataTable:Ie,LFilterSection:Oe,LoadingSpinner:T},data(){return{isLoading:!0,initialOptionsLoaded:!1,currentFilters:{quarter:"",province_area:"",company:"",dataasset_content:""},chartRowActiveFilters:{},lsTableActiveFilters:{quarter:""},filterDropdownOptions:{quarter:[],province_area:[]},lsTableData:[],lsTableTotalRows:0,lsTableCurrentPage:1,lsTablePageSize:10,isLsTableLoading:!1}},methods:{handleFilterApplyForTable(t){if(this.currentFilters={...t},""===t.quarter){let e="";this.filterDropdownOptions.quarter&&this.filterDropdownOptions.quarter.length>0&&(e=this.filterDropdownOptions.quarter[0]),this.lsTableActiveFilters={...t,quarter:e},this.currentFilters.quarter=e}else this.lsTableActiveFilters={...t};this.lsTableCurrentPage=1,this.fetchLSDataTableData(this.lsTableCurrentPage)},handleLSPageChange(t){this.lsTableCurrentPage=t,this.fetchLSDataTableData(t)},handlePageSizeChange(){this.lsTableCurrentPage=1,this.fetchLSDataTableData(this.lsTableCurrentPage)},async fetchLSDataTableData(t=1){this.$refs.lsDataTableRef&&"function"===typeof this.$refs.lsDataTableRef.showLoading?this.$refs.lsDataTableRef.showLoading():this.isLsTableLoading=!0;try{const e={filters:this.lsTableActiveFilters,page:t,pageSize:this.lsTablePageSize},a=await g.A.post("/api/lasset/summary",e);a.data&&a.data.table?(this.lsTableData=a.data.table.rows||[],this.lsTableTotalRows=a.data.table.total||0):(this.lsTableData=[],this.lsTableTotalRows=0)}catch(e){console.error("获取 LSDataTable 数据失败:",e.response||e.message||e),this.lsTableData=[],this.lsTableTotalRows=0}finally{this.$refs.lsDataTableRef&&"function"===typeof this.$refs.lsDataTableRef.stopLoading?this.$refs.lsDataTableRef.stopLoading():this.isLsTableLoading=!1}},async fetchInitialData(){this.isLoading=!0;try{const t=await g.A.post("/api/lasset/summary",{filters:{},page:1,pageSize:1});t.data&&t.data.options?(this.filterDropdownOptions.quarter=t.data.options.quarter||[],this.filterDropdownOptions.quarter.length>0&&this.filterDropdownOptions.quarter.sort(((t,e)=>e.localeCompare(t))),this.filterDropdownOptions.province_area=t.data.options.province_area||[]):(this.filterDropdownOptions.quarter=[],this.filterDropdownOptions.province_area=[],console.warn("[LSDashboardPage] Initial options not found in API response. Setting dropdown options to empty.")),this.initialOptionsLoaded=!0;let e="";const a=this.filterDropdownOptions.quarter,s="2024Q4";a.length>0?a.includes(s)?e=s:(e=a[0],console.log(`[LSDashboardPage] Preferred default quarter '${s}' not found. Defaulting to latest available: '${e}'.`)):console.log("[LSDashboardPage] No quarters available to set a default."),this.currentFilters.quarter=e,this.lsTableActiveFilters={...this.currentFilters},this.chartRowActiveFilters={...this.currentFilters},await this.fetchLSDataTableData(this.lsTableCurrentPage)}catch(t){console.error("Error fetching initial data for LSDashboardPage:",t),this.filterDropdownOptions={quarter:[],province_area:[]},this.currentFilters={quarter:"",province_area:"",company:"",dataasset_content:""},this.lsTableActiveFilters={quarter:""},this.chartRowActiveFilters={},this.initialOptionsLoaded=!0}finally{this.isLoading=!1}}},async mounted(){await this.fetchInitialData()}},Ee=je,Be=(0,l.A)(Ee,le,ce,!1,null,"4af36a04",null),Ue=Be.exports,Ve=function(){var t=this,e=t._self._c;return e("div",{staticClass:"finance-page"},[t._m(0),e("div",{staticClass:"table-section"},[t._m(1),e("ChartSpinner",{attrs:{visible:t.loading.bank}}),t.loading.bank?t._e():e("div",{staticClass:"table-wrapper"},[t.bankData.length>0?e("table",{staticClass:"data-table",attrs:{id:"bank-table"}},[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("序号")]),t._l(t.bankTableDisplayConfig.columnOrder,(function(a){return e("th",{key:a},[t._v(" "+t._s(t.bankTableDisplayConfig.columnMap[a])+" ")])}))],2)]),e("tbody",t._l(t.bankData,(function(a,s){return e("tr",{key:s},[e("td",{staticStyle:{"text-align":"center"}},[t._v(" "+t._s((t.pagination.bank.currentPage-1)*t.pagination.bank.pageSize+s+1)+" ")]),t._l(t.bankTableDisplayConfig.columnOrder,(function(s){return e("td",{key:s,class:{"text-right":"finance_value"===s}},[e("span","month_time"===s?[t._v(" "+t._s(t.formatToChineseYearMonth(a[s]))+" ")]:"finance_value"===s?[t._v(" "+t._s(t.formatNumber(a[s]))+" ")]:[t._v(" "+t._s(a[s])+" ")])])}))],2)})),0)]):e("p",{staticClass:"no-data"},[t._v("没有数据可显示。")])]),!t.loading.bank&&t.bankData.length>0&&t.pagination.bank.totalPages>0?e("PaginationControls",{attrs:{"current-page":t.pagination.bank.currentPage,"total-pages":t.pagination.bank.totalPages,"page-size":t.pagination.bank.pageSize},on:{"page-changed":e=>t.changePage("bank",e)}}):t._e(),!t.loading.bank&&t.bankData.length>0&&t.pagination.bank.totalPages>1?e("div",{staticClass:"pagination-left-download"},[e("el-button",{staticClass:"download-btn-pagination",attrs:{loading:t.loading.bank_dl,type:"primary",size:"small"},on:{click:function(e){return t.download("bank")}}},[t._v(" 下载数据"),t.loading.bank_dl?t._e():e("i",{staticClass:"el-icon-arrow-down el-icon--right"})])],1):t._e()],1),e("hr",{staticClass:"section-divider"}),e("div",{staticClass:"table-section"},[t._m(2),e("ChartSpinner",{attrs:{visible:t.loading.stock}}),t.loading.stock?t._e():e("div",{staticClass:"table-wrapper"},[t.stockData.length>0?e("table",{staticClass:"data-table",attrs:{id:"stock-table"}},[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("序号")]),t._l(t.getHeaders(t.stockData,"stock"),(function(a){return e("th",{key:a},[t._v(t._s(a))])}))],2)]),e("tbody",t._l(t.stockData,(function(a,s){return e("tr",{key:s},[e("td",{staticStyle:{"text-align":"center"}},[t._v(" "+t._s((t.pagination.stock.currentPage-1)*t.pagination.stock.pageSize+s+1)+" ")]),t._l(t.getHeaders(t.stockData,"stock"),(function(s){return e("td",{key:s},[e("span","入股时间"===s?[t._v(t._s(t.formatToChineseYearMonth(a[s])))]:[t._v(t._s(t.formatValue(a[s])))])])}))],2)})),0)]):e("p",{staticClass:"no-data"},[t._v("没有数据可显示。")])]),!t.loading.stock&&t.stockData.length>0&&t.pagination.stock.totalPages>0?e("PaginationControls",{attrs:{"current-page":t.pagination.stock.currentPage,"total-pages":t.pagination.stock.totalPages,"page-size":t.pagination.stock.pageSize},on:{"page-changed":e=>t.changePage("stock",e)}}):t._e(),!t.loading.stock&&t.stockData.length>0&&t.pagination.stock.totalPages>0?e("div",{staticClass:"pagination-left-download"},[e("el-button",{staticClass:"download-btn-pagination",attrs:{loading:t.loading.stock_dl,type:"primary",size:"small"},on:{click:function(e){return t.download("stock")}}},[t._v(" 下载数据"),t.loading.stock_dl?t._e():e("i",{staticClass:"el-icon-arrow-down el-icon--right"})])],1):t._e()],1),e("hr",{staticClass:"section-divider"}),e("div",{staticClass:"table-section"},[t._m(3),e("ChartSpinner",{attrs:{visible:t.loading.other}}),t.loading.other?t._e():e("div",{staticClass:"table-wrapper"},[t.otherData.length>0?e("table",{staticClass:"data-table",attrs:{id:"other-table"}},[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("序号")]),t._l(t.getHeaders(t.otherData,"other"),(function(a){return e("th",{key:a},[t._v(t._s(a))])}))],2)]),e("tbody",t._l(t.otherData,(function(a,s){return e("tr",{key:s},[e("td",{staticStyle:{"text-align":"center"}},[t._v(" "+t._s((t.pagination.other.currentPage-1)*t.pagination.other.pageSize+s+1)+" ")]),t._l(t.getHeaders(t.otherData,"other"),(function(s){return e("td",{key:s},[e("span","日期"===s?[t._v(t._s(t.formatToChineseYearMonth(a[s])))]:[t._v(t._s(t.formatValue(a[s])))])])}))],2)})),0)]):e("p",{staticClass:"no-data"},[t._v("没有数据可显示。")])]),!t.loading.other&&t.otherData.length>0&&t.pagination.other.totalPages>0?e("PaginationControls",{attrs:{"current-page":t.pagination.other.currentPage,"total-pages":t.pagination.other.totalPages,"page-size":t.pagination.other.pageSize},on:{"page-changed":e=>t.changePage("other",e)}}):t._e(),!t.loading.other&&t.otherData.length>0&&t.pagination.other.totalPages>0?e("div",{staticClass:"pagination-left-download"},[e("el-button",{staticClass:"download-btn-pagination",attrs:{loading:t.loading.other_dl,type:"primary",size:"small"},on:{click:function(e){return t.download("other")}}},[t._v(" 下载数据"),t.loading.other_dl?t._e():e("i",{staticClass:"el-icon-arrow-down el-icon--right"})])],1):t._e()],1)])},He=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"dashboard-title-block"},[e("h1",{staticClass:"dashboard-title"},[t._v("数据相关融资情况")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-header"},[e("h3",{staticClass:"section-title"},[t._v("数据资产增信银行贷款")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-header"},[e("h3",{staticClass:"section-title"},[t._v("数据资产作价入股")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-header"},[e("h3",{staticClass:"section-title"},[t._v("其他数据类融资")])])}],Ye={name:"FinanceDashboardPage",components:{ChartSpinner:A,PaginationControls:Zt},data(){return{bankData:[],stockData:[],otherData:[],loading:{bank:!1,stock:!1,other:!1,bank_dl:!1,stock_dl:!1,other_dl:!1},apiBase:"/api/finance",pagination:{bank:{currentPage:1,pageSize:10,totalRows:0,totalPages:1},stock:{currentPage:1,pageSize:10,totalRows:0,totalPages:1},other:{currentPage:1,pageSize:10,totalRows:0,totalPages:1}},bankTableDisplayConfig:{columnMap:{month_time:"入表月份",show_name:"入表企业",dataasset_content:"数据资产内容",finance_value:"融资金额（万元）",finance_type:"融资类型",finance_orgs:"融资机构"},columnOrder:["month_time","show_name","dataasset_content","finance_value","finance_type","finance_orgs"]}}},mounted(){this.fetchData("bank",1),this.fetchData("stock",1),this.fetchData("other",1)},methods:{formatToChineseYearMonth:O,formatNumber:R,formatPercentage:z,getHeaders(t,e){return"bank"===e&&t&&t.length>0?this.bankTableDisplayConfig.columnOrder:t&&t.length>0?Object.keys(t[0]):[]},formatValue(t){return null!==t&&void 0!==t?String(t):""},async fetchData(t,e,a){this.loading[t]=!0;const s=this.pagination[t],i=void 0!==a?a:s.pageSize;try{const a=await g.A.get(`${this.apiBase}/data/${t}`,{params:{page:e,pageSize:i}});a&&a.data&&Array.isArray(a.data.data)?(this[`${t}Data`]=a.data.data,s.totalRows=a.data.total||0,s.pageSize=i,s.totalPages=Math.ceil(s.totalRows/s.pageSize)||1,s.currentPage=e):(console.error(`Error fetching ${t} data: Invalid response structure.`,a.data),this[`${t}Data`]=[],s.totalRows=0,s.totalPages=1,this.$message?this.$message.error(`加载 ${t} 数据失败：响应格式不正确`):alert(`加载 ${t} 数据失败：响应格式不正确`))}catch(n){console.error(`Error fetching ${t} data:`,n),this[`${t}Data`]=[],s.totalRows=0,s.totalPages=1,this.$message?this.$message.error(`加载 ${t} 数据失败`):alert(`加载 ${t} 数据失败`)}finally{this.loading[t]=!1}},async download(t){const e=`${this.apiBase}/export/${t}`,a=`${t}_dl`;let s="";const i=new Date,n=i.getFullYear(),r=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getDate()).padStart(2,"0"),l=`${n}${r}${o}`;switch(t){case"bank":s=`数据资产增信银行贷款清单_${l}.pdf`;break;case"stock":s=`数据资产作价入股清单_${l}.pdf`;break;case"other":s=`其他数据类融资清单_${l}.pdf`;break;default:s=`导出数据_${l}.pdf`}try{this.loading[a]=!0;const t=await(0,g.A)({url:e,method:"POST",responseType:"blob"}),i=new Blob([t.data],{type:"application/pdf"}),n=document.createElement("a");n.href=window.URL.createObjectURL(i),n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(n.href),this.$message&&this.$message.success("文件已开始下载")}catch(c){console.error(`导出 ${t} 报告失败:`,c);let e="导出失败，请稍后重试";if(c.response)try{const t=await c.response.data.text(),a=JSON.parse(t);a&&a.error&&(e=a.error)}catch(d){e=`导出失败: ${c.response.statusText||"服务器发生错误"}`}this.$message?this.$message.error(e):alert(e)}finally{this.loading[a]=!1}},changePage(t,e){const a=this.pagination[t];e>=1&&e<=a.totalPages&&e!==a.currentPage&&this.fetchData(t,e,a.pageSize)}}},Ke=Ye,Ge=(0,l.A)(Ke,Ve,He,!1,null,"cfe1a53e",null),Je=Ge.exports,We=function(){var t=this,e=t._self._c;return e("div",{staticClass:"admin-container"},[e("aside",{class:["sidebar",{collapsed:t.isSidebarCollapsed}]},[t.isSidebarCollapsed?t._e():e("div",{staticClass:"sidebar-title"},[t._v(" 数据明细管理 "),e("button",{staticClass:"collapse-btn",on:{click:t.toggleSidebar}},[t._v("◀")])]),t.isSidebarCollapsed?t._e():e("nav",{staticClass:"menu"},[e("div",{staticClass:"menu-item",class:{active:"listed"===t.currentTab},on:{click:function(e){return t.switchTab("listed")}}},[t._v(" 上市公司数据 ")]),e("div",{staticClass:"menu-item",class:{active:"nonlisted"===t.currentTab},on:{click:function(e){return t.switchTab("nonlisted")}}},[t._v(" 非上市公司数据 ")]),e("div",{staticClass:"menu-item",class:{active:t.isFinanceTabActive}},[t._v(" 数据资产融资 ")]),e("div",{staticClass:"menu-subitem",class:{active:"finance-bank"===t.currentTab},on:{click:function(e){return t.switchTab("finance-bank")}}},[t._v(" 数据资产增信银行贷款 ")]),e("div",{staticClass:"menu-subitem",class:{active:"finance-stock"===t.currentTab},on:{click:function(e){return t.switchTab("finance-stock")}}},[t._v(" 数据资产作价入股 ")]),e("div",{staticClass:"menu-subitem",class:{active:"finance-other"===t.currentTab},on:{click:function(e){return t.switchTab("finance-other")}}},[t._v(" 其他数据类融资 ")])])]),t.isSidebarCollapsed?e("button",{staticClass:"expand-btn",on:{click:t.toggleSidebar}},[t._v("▶")]):t._e(),e("main",{staticClass:"content"},[e("h1",{staticClass:"content-title"},[t._v(t._s(t.currentContentTitle))]),e("p",{staticClass:"update-time"},[t._v("上次更新时间："+t._s(t.formattedLastUpdate))]),t._v(" "),e("div",{staticClass:"search-bar"},[e("button",{staticClass:"clear-all-btn",on:{click:t.clearAllFilters}},[t._v("清空全部筛选")]),e("label",[t._v("关键词检索：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKeyword,expression:"searchKeyword"}],attrs:{placeholder:"请输入关键词..."},domProps:{value:t.searchKeyword},on:{input:[function(e){e.target.composing||(t.searchKeyword=e.target.value)},t.handleSearchDebounced]}})]),e("div",{staticClass:"table-wrapper"},[e("ChartSpinner",{attrs:{visible:t.tableLoadingState[t.currentTab],"show-watermark":!1}}),t.tableLoadingState[t.currentTab]?t._e():[t.pagedData.length>0?e("table",{staticClass:"data-table"},[e("thead",[e("tr",[e("th",[t._v("序号")]),t._l(t.displayableTableHeaders,(function(a){return[e("th",{key:a,staticStyle:{position:"relative"}},[e("div",{staticClass:"th-wrapper"},[t._v(" "+t._s("status"===a?"状态":"updated_at"===a?"更新时间":a)+" "),t.isColumnFilterable(a)?[e("span",{staticClass:"filter-icon",attrs:{"data-filter-icon":a},on:{click:function(e){return e.stopPropagation(),t.toggleFilterDropdown(a)}}},[t._v("⏷")]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showFilterDropdown[a],expression:"showFilterDropdown[colKey]"}],staticClass:"filter-dropdown",attrs:{"data-dropdown":a},on:{click:function(t){t.stopPropagation()}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.filterSearch[a],expression:"filterSearch[colKey]"}],staticClass:"filter-search-input",attrs:{placeholder:"搜索该列..."},domProps:{value:t.filterSearch[a]},on:{input:function(e){e.target.composing||t.$set(t.filterSearch,a,e.target.value)}}}),e("div",{staticClass:"filter-options"},t._l(t.getFilteredOptions(a),(function(s){return e("label",{key:s},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.pendingFilters[a],expression:"pendingFilters[colKey]"}],attrs:{type:"checkbox"},domProps:{value:s,checked:Array.isArray(t.pendingFilters[a])?t._i(t.pendingFilters[a],s)>-1:t.pendingFilters[a]},on:{change:function(e){var i=t.pendingFilters[a],n=e.target,r=!!n.checked;if(Array.isArray(i)){var o=s,l=t._i(i,o);n.checked?l<0&&t.$set(t.pendingFilters,a,i.concat([o])):l>-1&&t.$set(t.pendingFilters,a,i.slice(0,l).concat(i.slice(l+1)))}else t.$set(t.pendingFilters,a,r)}}}),t._v(" "+t._s("status"===a&&t.statusDisplayMap[s]||s)+" ")])})),0),e("div",{staticClass:"filter-footer"},[e("button",{on:{click:function(e){return t.clearFilter(a)}}},[t._v("清空筛选")]),e("button",{on:{click:function(e){return t.confirmFilter(a)}}},[t._v("确定")])])])]:t._e()],2)])]}))],2)]),e("tbody",t._l(t.pagedData,(function(a,s){return e("tr",{key:a.id||s,class:t.getRowClass(a)},[e("td",{staticStyle:{"text-align":"center"}},[t._v(" "+t._s((t.currentPage-1)*t.pageSize+s+1)+" ")]),t._l(t.displayableTableHeaders,(function(s){return e("td",{key:s,class:{"status-cell":"status"===s,"text-right":"数据资源入表总额（万元）"===s||"市值（亿元）"===s||"无形资产-数据资源入表金额（万元）"===s||"开发支出-数据资源入表金额（万元）"===s||"存货-数据资源入表金额（万元）"===s||"book_value"===s||"assess_value"===s||"finance_value"===s||"融资金额（万元）"===s||"注册资本（万元）"===s||"数据资产占总资产比例"===s||"股权占比"===s}},["status"===s?["repeat"===a.status?e("div",{staticClass:"status-display status-repeat"},[e("span",{staticClass:"status-text"},[t._v("重复")]),e("div",{staticClass:"action-buttons-group"},[e("button",{staticClass:"action-btn delete-btn-small",on:{click:function(e){return t.updateRowStatus(a,"delete")}}},[t._v("删除")]),e("button",{staticClass:"action-btn keep-btn-small",on:{click:function(e){return t.updateRowStatus(a,"kept")}}},[t._v("保留")])])]):"delete"===a.status?e("div",{staticClass:"status-display status-deleted"},[e("span",{staticClass:"status-text"},[t._v("已删除")]),e("div",{staticClass:"action-buttons-group"},[e("button",{staticClass:"action-btn keep-btn-small",on:{click:function(e){return t.updateRowStatus(a,"kept")}}},[t._v("保留")])])]):"kept"===a.status?e("div",{staticClass:"status-display status-kept"},[e("span",{staticClass:"status-text"},[t._v("已保留")]),e("div",{staticClass:"action-buttons-group"},[e("button",{staticClass:"action-btn delete-btn-small",on:{click:function(e){return t.updateRowStatus(a,"delete")}}},[t._v("删除")]),e("button",{staticClass:"action-btn restore-btn-small",on:{click:function(e){return t.updateRowStatus(a,null)}}},[t._v("恢复")])])]):e("div",{staticClass:"status-display status-normal"},[e("div",{staticClass:"action-buttons-group"},[e("button",{staticClass:"action-btn delete-btn-small",on:{click:function(e){return t.updateRowStatus(a,"delete")}}},[t._v("删除")])])])]:[e("span",{domProps:{innerHTML:t._s(t.applyCellFormatting(a[s],s))}})]],2)}))],2)})),0)]):e("p",{staticClass:"no-data"},[t._v("暂无数据或结果为空")])]],2),t.totalPages>0&&!t.tableLoadingState[t.currentTab]&&t.pagedData.length>0?e("PaginationControls",{attrs:{"current-page":t.currentPage,"total-pages":t.totalPages,"page-size":t.pageSize},on:{"page-changed":t.changePage}}):t._e(),e("div",{staticClass:"export-controls"},["finance-bank"!==t.currentTab?e("label",{staticClass:"upload-btn"},[t._v(" 上传数据 "),e("input",{ref:"fileInput",attrs:{type:"file",accept:".xlsx",hidden:""},on:{change:t.handleUpload}})]):t._e(),e("button",{staticClass:"export-btn",on:{click:t.exportExcel}},[t._v("导出 Excel")])])],1)])},Qe=[];a(2489);const Xe=g.A.create({baseURL:"/api"}),Ze=(t,e="API请求失败")=>{console.error(`${e}:`,t.response||t.message||t);const a=t.response?.data?.error||t.response?.data?.detail||t.response?.data?.message,s="操作失败，请检查网络或联系管理员。";throw new Error(a||s)},ta=async(t,e={})=>{const a=`/admintable/tabledata/${t}`;let s={...e};s.filters&&"object"===typeof s.filters&&(s.filters=JSON.stringify(s.filters)),console.log(`[adminApiService] Calling loadAdminTableData for tab: ${t}, URL: ${a}, Params:`,s);try{const t=await Xe.get(a,{params:s});return{data:t.data?.data||[],total:t.data?.total||0,tableLastUpdate:t.data?.tableLastUpdate||null}}catch(i){return Ze(i,`加载 Admin Tab [${t}] 数据失败`)}},ea=async(t,e)=>{try{const a=await Xe.post(`/upload/append?tableName=${t}`,e,{headers:{"Content-Type":"multipart/form-data"}});return a.data}catch(a){return Ze(a,`上传数据到表 ${t} 失败`)}},aa=async(t,e,a)=>{try{const s=await Xe.put(`/adminpage/status/${t}/${e}`,{status:a});return s.data}catch(s){return Ze(s,`更新行 ${e} (表: ${t}) 状态为 ${a} 失败`)}},sa=t=>{if(!t)throw console.error("exportTableToExcel: dbTableName is required."),new Error("导出操作缺少必要的表名参数。");const e=`${Xe.defaults.baseURL||""}/export/${encodeURIComponent(t)}`;console.log("Exporting Excel with URL (path param):",e),window.open(e)};async function ia(t){const e=`/admintable/distinct-values/${t}`;try{const t=await Xe.get(e);return t.data}catch(a){throw console.error(`[AdminApiService] Failed to load distinct column values for tab ${t}:`,a),new Error(a.response?.data?.message||`获取 '${t}' 表格的筛选选项失败`)}}var na={name:"AdminPage",components:{ChartSpinner:A,PaginationControls:Zt},data(){return{currentTab:"listed",tableData:[],tableDataTotalRows:0,tableHeaders:[],processedTableHeaders:[],tableLastUpdateTimes:{},currentPage:1,pageSize:15,isSidebarCollapsed:!1,filters:{},pendingFilters:{},filterSearch:{},uniqueColumnValues:{},filterOptionsCache:{},searchKeyword:"",searchDebounceTimer:null,showFilterDropdown:{},tableLoadingState:{listed:!0,nonlisted:!0,"finance-bank":!0,"finance-stock":!0,"finance-other":!0},statusDisplayMap:{repeat:"重复",delete:"已删除",kept:"已保留",null:"正常"},columnFormattersConfig:{register_date:N,updated_at:M,month_time:O,"入股时间":O,"日期":O,"数据资源入表总额（万元）":t=>R(t,2),"市值（亿元）":t=>R(t,2),"无形资产-数据资源入表金额（万元）":t=>R(t,2),"开发支出-数据资源入表金额（万元）":t=>R(t,2),"存货-数据资源入表金额（万元）":t=>R(t,2),book_value:t=>R(t,2),assess_value:t=>R(t,2),finance_value:t=>R(t,2),"融资金额（万元）":t=>R(t,2),"注册资本（万元）":t=>R(t,2),"数据资产占总资产比例":t=>z(t,1),"股权占比":t=>z(t,1)},tableNameMap:{listed:"dataasset_listed_companies_2024",nonlisted:"dataasset_non_listed_companies","finance-bank":"dataasset_finance_bank","finance-stock":"dataasset_finance_stock","finance-other":"dataasset_finance_other"}}},computed:{isFinanceTabActive(){return["finance-bank","finance-stock","finance-other"].includes(this.currentTab)},currentContentTitle(){switch(this.currentTab){case"listed":return"上市公司数据";case"nonlisted":return"非上市公司数据";case"finance-bank":return"数据资产增信银行贷款";case"finance-stock":return"数据资产作价入股";case"finance-other":return"其他数据类融资";default:return"数据明细管理"}},displayableTableHeaders(){return this.processedTableHeaders},formattedLastUpdate(){const t=this.tableLastUpdateTimes[this.currentTab];if(!t)return"暂无记录";const e=new Date(t);return isNaN(e.getTime())?"无效日期":this.formatToDateTimeSec(t)},pagedData(){return this.tableData},totalPages(){return Math.max(1,Math.ceil(this.tableDataTotalRows/this.pageSize))}},methods:{formatToChineseYearMonth:O,formatToYYYYMMDD:N,formatNumber:R,formatPercentage:z,formatToDateTimeSec:M,applyCellFormatting(t,e){const a=this.columnFormattersConfig[e];return"function"===typeof a?a(t):this.highlight(String(null!==t&&void 0!==t?t:""),e)},isColumnFilterable(t){let e=String(t);return e=e.replace(/"/g,""),Object.prototype.hasOwnProperty.call(this.uniqueColumnValues,e)&&this.uniqueColumnValues[e]&&this.uniqueColumnValues[e].length>0},currentTabUsesBackendProcessing(){return!0},getRowClass(t){if(!t||"undefined"===typeof t.status)return"row-normal";switch(t.status){case"delete":return"row-deleted";case"repeat":return"row-repeat";case"kept":return"row-kept";default:return"row-normal"}},toggleSidebar(){this.isSidebarCollapsed=!this.isSidebarCollapsed},async switchTab(t){if(this.currentTab!==t){this.currentTab=t,this.clearAllFilters(!1),this.currentPage=1,this.tableData=[],this.tableDataTotalRows=0,this.uniqueColumnValues={},Object.prototype.hasOwnProperty.call(this.tableLoadingState,this.currentTab)&&(this.tableLoadingState[this.currentTab]=!0);try{await this.loadFilterOptions()}finally{this.loadData()}}},async loadData(){Object.prototype.hasOwnProperty.call(this.tableLoadingState,this.currentTab)&&!this.tableLoadingState[this.currentTab]&&(this.tableLoadingState[this.currentTab]=!0);try{const t={page:this.currentPage,pageSize:this.pageSize,filters:this.filters,searchKeyword:this.searchKeyword.trim()},e=await ta(this.currentTab,t);this.tableData=e.data||[],this.tableDataTotalRows=e.total||0,this.$set(this.tableLastUpdateTimes,this.currentTab,e.tableLastUpdate),this.tableHeaders=this.tableData.length>0?Object.keys(this.tableData[0]):[];let a=[...this.tableHeaders];const s=a.indexOf("updated_at");if(s>-1){const t=a.splice(s,1)[0];a.push(t)}const i=a.indexOf("id");if(i>-1&&a.splice(i,1),"finance-bank"===this.currentTab){const t=a.indexOf("status");t>-1&&a.splice(t,1)}else{const t=a.indexOf("status");if(t>-1){const e=a.splice(t,1)[0];a.unshift(e)}}this.processedTableHeaders=a}catch(t){const e=t.message||"数据加载失败！";this.$message&&"function"===typeof this.$message.error?this.$message.error(e):alert(e),this.tableData=[],this.tableHeaders=[],this.tableDataTotalRows=0}finally{Object.prototype.hasOwnProperty.call(this.tableLoadingState,this.currentTab)&&(this.tableLoadingState[this.currentTab]=!1)}},async updateRowStatus(t,e){if(!t||"undefined"===typeof t.id)return void(this.$message?this.$message.error("行数据无效（缺少ID），无法更新状态。"):alert("行数据无效（缺少ID），无法更新状态。"));const a=t.id,s=this.tableNameMap[this.currentTab];if(s)try{await aa(s,a,e),this.$message?this.$message.success("状态更新成功！"):alert("状态更新成功！"),await this.loadData()}catch(i){this.$message?this.$message.error(i.message):alert(i.message)}else this.$message?this.$message.error("当前数据类型未知或不支持状态更新。"):alert("当前数据类型未知或不支持状态更新。")},async handleUpload(t){const e=t.target.files[0];if(!this.$refs.fileInput)return;if(!e)return void(this.$refs.fileInput&&(this.$refs.fileInput.value=""));const a=new FormData;a.append("file",e);const s=this.tableNameMap[this.currentTab];if(!s||"finance-bank"===this.currentTab)return this.$message?this.$message.error("当前数据类型不支持上传。"):alert("当前数据类型不支持上传。"),void(this.$refs.fileInput&&(this.$refs.fileInput.value=""));Object.prototype.hasOwnProperty.call(this.tableLoadingState,this.currentTab)&&(this.tableLoadingState[this.currentTab]=!0);try{const t=await ea(s,a);this.$message?this.$message.success(t.message||"上传处理完成！"):alert(t.message||"上传处理完成！"),this.filterOptionsCache[this.currentTab]&&(delete this.filterOptionsCache[this.currentTab],console.log(`[AdminPage] Cleared filter options cache for tab: ${this.currentTab} after upload.`)),this.currentPage=1,await this.loadFilterOptions(),await this.loadData()}catch(i){this.$message?this.$message.error(i.message):alert(i.message)}finally{Object.prototype.hasOwnProperty.call(this.tableLoadingState,this.currentTab)&&(this.tableLoadingState[this.currentTab]=!1),this.$refs.fileInput&&(this.$refs.fileInput.value="")}},async loadFilterOptions(){if(this.currentTab){if(this.filterOptionsCache[this.currentTab])return this.uniqueColumnValues=this.filterOptionsCache[this.currentTab],void console.log(`[AdminPage] Using cached filter options for tab: ${this.currentTab}`);console.log(`[AdminPage] Loading filter options for tab: ${this.currentTab} from API.`);try{const t=await ia(this.currentTab);this.uniqueColumnValues=t||{},this.filterOptionsCache[this.currentTab]=this.uniqueColumnValues,console.log("[AdminPage] Filter options loaded:",this.uniqueColumnValues)}catch(t){const e=t.message||"筛选选项加载失败！";this.$message&&"function"===typeof this.$message.error?this.$message.error(e):alert(e),this.uniqueColumnValues={}}}else console.warn("[AdminPage] Cannot load filter options: currentTab is not set.")},clearAllFilters(t=!0){this.filters={},this.pendingFilters={},this.filterSearch={},this.searchKeyword="",this.currentPage=1,t&&this.loadData()},toggleFilterDropdown(t){const e=220,a=this.showFilterDropdown[t];this.closeAllDropdowns(),this.$set(this.showFilterDropdown,t,!a),a||(this.$set(this.pendingFilters,t,Array.isArray(this.filters[t])?[...this.filters[t]]:[]),this.$set(this.filterSearch,t,""),this.$nextTick((()=>{const a=this.$el.querySelector(`[data-filter-icon="${t}"]`),s=this.$el.querySelector(`[data-dropdown="${t}"]`);if(a&&s){const t=a.getBoundingClientRect();s.style.position="fixed",s.style.top=`${t.bottom+4}px`,s.style.left=`${Math.max(0,t.right-e)}px`,s.style.zIndex="100"}})))},confirmFilter(t){this.$set(this.filters,t,Array.isArray(this.pendingFilters[t])?[...this.pendingFilters[t]]:[]),this.closeAllDropdowns(),this.currentPage=1,this.loadData()},clearFilter(t){this.$set(this.pendingFilters,t,[]),this.$set(this.filters,t,[]),this.closeAllDropdowns(),this.currentPage=1,this.loadData()},closeAllDropdowns(){Object.keys(this.showFilterDropdown).forEach((t=>{this.$set(this.showFilterDropdown,t,!1)}))},handleClickOutside(t){const e=t.target.closest(".filter-dropdown"),a=t.target.closest(".filter-icon");e||a||this.closeAllDropdowns()},getFilteredOptions(t){if(!this.uniqueColumnValues||!Array.isArray(this.uniqueColumnValues[t]))return[];const e=(this.filterSearch[t]||"").toLowerCase();return this.uniqueColumnValues[t].filter((t=>String(t).toLowerCase().includes(e)))},handleSearchDebounced(){clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=setTimeout((()=>{this.currentPage=1,this.loadData()}),500)},highlight(t,e){if("id"===e||"status"===e)return String(null!==t&&void 0!==t?t:"");const a=String(null!==t&&void 0!==t?t:"");if(!this.searchKeyword.trim()||!a)return a;const s=/[\\.^$*+?()[\]{}|]/g,i=this.searchKeyword.trim().replace(s,"\\$&"),n=new RegExp(`(${i})`,"gi");return a.replace(n,"<mark>$1</mark>")},changePage(t){t>=1&&t<=this.totalPages&&t!==this.currentPage&&(this.currentPage=t,this.loadData())},exportExcel(){const t=this.tableNameMap[this.currentTab];if(t)try{sa(t)}catch(e){this.$message?this.$message.error(e.message):alert(e.message)}else this.$message?this.$message.error("当前数据类型不支持导出。"):alert("当前数据类型不支持导出。")}},async mounted(){Object.prototype.hasOwnProperty.call(this.tableLoadingState,this.currentTab)&&(this.tableLoadingState[this.currentTab]=!0),await this.loadFilterOptions(),this.loadData(),document.addEventListener("mousedown",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("mousedown",this.handleClickOutside),clearTimeout(this.searchDebounceTimer)}},ra=na,oa=(0,l.A)(ra,We,Qe,!1,null,"3b337428",null),la=oa.exports;s["default"].use(h.Ay);const ca=[{path:"/",name:"HomePage",component:E},{path:"/dashboard",name:"NLSDashboardPage",component:oe},{path:"/lsdashboard",name:"LSDashboardPage",component:Ue},{path:"/financedashboard",name:"FinanceDashboardPage",component:Je},{path:"/admin-page",name:"AdminPage",component:la,beforeEnter:(t,e,a)=>{"true"===localStorage.getItem("adminLoggedIn")?a():a("/")}}];var da=new h.Ay({routes:ca}),ha=a(1052),pa=a.n(ha),ua=a(688),ga=a(3487);ua.use([nt.a,ga.a,ot.a,ct.a,lt.a,it.a]),s["default"].prototype.$echarts=ua,g.A.defaults.baseURL="https://platform-production-717b.up.railway.app",console.log("API baseURL set to:","'https://platform-production-717b.up.railway.app'"),g.A.defaults.timeout=2e4,s["default"].config.productionTip=!1,s["default"].use(pa()),new s["default"]({router:da,render:t=>t(d)}).$mount("#app")},3546:function(t,e,a){t.exports=a.p+"img/SAIF LOGO.9469aaa4.jpg"},3854:function(t,e,a){t.exports=a.p+"img/CAFR.1a2f0cf9.png"},8305:function(t,e,a){t.exports=a.p+"img/header_image.a3ff36e6.jpg"},8547:function(t,e,a){t.exports=a.p+"img/footer_image.680083ad.jpg"}},e={};function a(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=t,function(){a.amdO={}}(),function(){var t=[];a.O=function(e,s,i,n){if(!s){var r=1/0;for(d=0;d<t.length;d++){s=t[d][0],i=t[d][1],n=t[d][2];for(var o=!0,l=0;l<s.length;l++)(!1&n||r>=n)&&Object.keys(a.O).every((function(t){return a.O[t](s[l])}))?s.splice(l--,1):(o=!1,n<r&&(r=n));if(o){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[s,i,n]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){a.p="/"}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,n,r=s[0],o=s[1],l=s[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(l)var d=l(a)}for(e&&e(s);c<r.length;c++)n=r[c],a.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return a.O(d)},s=self["webpackChunkdata_asset_platform"]=self["webpackChunkdata_asset_platform"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(3054)}));s=a.O(s)})();
//# sourceMappingURL=app.34a8a051.js.map